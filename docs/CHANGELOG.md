# История изменений

## 2025-01-XX (latest)

### ✅ Разделение STECCOM данных на Monthly и Suspended
- **Добавлены две отдельные колонки для планов:**
  - `STECCOM_PLAN_NAME_MONTHLY` - основной тариф (пусто, если нет)
  - `STECCOM_PLAN_NAME_SUSPENDED` - suspended тариф (пусто, если нет)
- **Добавлены две отдельные колонки для сумм:**
  - `STECCOM_MONTHLY_AMOUNT` - сумма основного тарифа
  - `STECCOM_SUSPENDED_AMOUNT` - сумма suspended тарифа
- **Группировка:** одна строка для каждого IMEI + период (не дублируются)
- **Обновлены представления:**
  - `V_CONSOLIDATED_OVERAGE_REPORT` (PostgreSQL и Oracle)
  - `V_CONSOLIDATED_REPORT_WITH_BILLING` (PostgreSQL и Oracle)
- **Обновлен Streamlit:** добавлены колонки "Plan Monthly" и "Plan Suspended"
- **Логика:** если есть основной тариф - показывается основной план, если только suspended - показывается suspended план

### ✅ Исправления
- Убрана дублирующая колонка "Plan Name" из Streamlit (дублировала "Plan Monthly")
- План теперь определяется корректно для устройств только с suspended тарифом

## 2025-10-28 (final)

### ✅ Упрощение приложения
- **Убрано:** управление тарифами (редактор)
- **Убрано:** все статистики и метрики
- **Убрано:** графики и визуализации
- **Оставлено:** только основной отчет и фильтры

### ✅ Фокус на SBD-1 и SBD-10
- Расчет выполняется **ТОЛЬКО** для двух тарифов:
  - SBD-1 (SBD Tiered 1250 1K)
  - SBD-10 (SBD Tiered 1250 10K)
- Все остальные тарифы деактивированы
- Цены из технического задания (реальные)

### ✅ Названия колонок
- Все колонки на **английском** как в CSV файлах
- Соответствие оригинальным названиям:
  - Contract ID
  - IMEI
  - Plan Name
  - Bill Month
  - Usage (KB)
  - Included (KB)
  - Overage (KB)
  - Calculated Overage ($)
  - и т.д.

### ✅ Конвертация единиц
- **1 KB = 1000 bytes** (десятичная система)
- **1 MB = 1000 KB** (не 1024)
- Исправлено во всех файлах:
  - `setup_postgres.sql`
  - `load_data_postgres.py`
  - `load_spnet_traffic.py`
  - `oracle_tables.sql`

### ✅ Структура приложения
Упрощенная структура:
```
┌─────────────────────────────────┐
│  Iridium M2M Overage Report     │
│  SBD-1 and SBD-10 Plans Only    │
├─────────────────────────────────┤
│  Sidebar:                       │
│    - Period filter              │
│    - Plan filter                │
├─────────────────────────────────┤
│  Main:                          │
│    - Records count              │
│    - Data table                 │
│    - Export (CSV, Excel)        │
└─────────────────────────────────┘
```

## 2025-10-28 (previous)

### ✅ Объединение приложений
- Объединил отдельную админку тарифов в основное приложение
- Две вкладки: Отчеты + Управление тарифами

### ✅ Исправление конвертации
- Переход с 1024 на 1000 для KB/MB

## Текущий статус

✅ **Готово:**
- Упрощенное приложение только с отчетом
- Фильтры: Period, Plan
- Экспорт: CSV, Excel
- Расчет только для SBD-1 и SBD-10
- Правильная конвертация (1000)
- Названия колонок на английском

✅ **Тарифы:**
- SBD-1: 1 KB, $1.50/$0.75/$0.50
- SBD-10: 10 KB, $0.30/$0.20/$0.10

✅ **Данные:**
- Только из CSV файлов
- Никаких выдуманных данных
- 4,225 записей для SBD-10
- 1,213 уникальных IMEI
- $26,529.07 превышений

## Запуск

```bash
streamlit run streamlit_report.py --server.port 8502
```

**URL:** http://localhost:8502
