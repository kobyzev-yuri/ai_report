# –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞ - 2025-10-28

## ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**URL:** http://localhost:8502  
**PID:** 549427  
**–°—Ç–∞—Ç—É—Å:** –ó–∞–ø—É—â–µ–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üìä –û—Ç—á–µ—Ç - —á—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
- **–í—Å–µ —Ç–∞—Ä–∏—Ñ—ã** –ø–æ–∫–∞–∑–∞–Ω—ã –≤ –æ—Ç—á–µ—Ç–µ (8 —Ç–∞—Ä–∏—Ñ–æ–≤)
- **Calculated Overage** —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –¢–û–õ–¨–ö–û –¥–ª—è SBD-1 –∏ SBD-10
- **SPNet Total Amount** –≤–∫–ª—é—á–∞–µ—Ç –í–°–ï —Ç–∏–ø—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
  - SBD Data Usage
  - SBD Mailbox Checks
  - SBD Registrations
- **–ù–∞–∑–≤–∞–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫** –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º (–∫–∞–∫ –≤ CSV)
- **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è:** 1 KB = 1000 bytes (–¥–µ—Å—è—Ç–∏—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞)

### –ö–æ–ª–æ–Ω–∫–∏ –æ—Ç—á–µ—Ç–∞
1. IMEI
2. Contract ID
3. Plan Name
4. Bill Month (YYYY-MM)
5. Usage (KB)
6. Included (KB)
7. Overage (KB)
8. **Calculated Overage ($)** - —Ç–æ–ª—å–∫–æ –¥–ª—è SBD-1 –∏ SBD-10
9. SPNet Total Amount ($) - –≤—Å–µ —Ç–∏–ø—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
10. Advance Charge ($)
11. STECCOM Total Amount ($)
12. Overage Diff ($)
13. Total Diff ($)

### –§–∏–ª—å—Ç—Ä—ã
- **Period** - –≤—ã–±–æ—Ä –ø–µ—Ä–∏–æ–¥–∞ (All Periods / 2025-09 / –∏ —Ç.–¥.)
- **Plan** - –≤—ã–±–æ—Ä —Ç–∞—Ä–∏—Ñ–∞ (All Plans / –∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π)

### –≠–∫—Å–ø–æ—Ä—Ç
- CSV
- Excel (XLSX)

## üìà –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ

| Plan | Records | Devices | SPNet Total | Calculated Overage | STECCOM Total |
|------|---------|---------|-------------|-------------------|---------------|
| SBD Tiered 1250 10K | 4,227 | 1,214 | $1,213.16 | **$26,529.07** | $44,110.17 |
| SSG LBS 8MB | 4,543 | 1,110 | $0.00 | - | - |
| SBD Tiered 350 1K | 1,683 | 592 | $0.22 | - | $5,191.57 |
| LBS 1 | 107 | 26 | $1,172.05 | - | - |
| SBD Demo | 107 | 81 | $0.00 | - | - |
| LBS Demo | 13 | 6 | $0.00 | - | - |
| SBD 30 | 7 | 4 | $552.87 | - | $184.83 |
| SBD 12 | 6 | 2 | $0.00 | - | $91.53 |

## üéØ –¢–∞—Ä–∏—Ñ—ã —Å —Ä–∞—Å—á–µ—Ç–æ–º –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è

### SBD-1 (SBD Tiered 1250 1K)
```
–í–∫–ª—é—á–µ–Ω–æ: 1 KB
–°—Ç—É–ø–µ–Ω—å 1:  1-10 KB √ó $1.50/KB
–°—Ç—É–ø–µ–Ω—å 2: 10-25 KB √ó $0.75/KB
–°—Ç—É–ø–µ–Ω—å 3:    25+ KB √ó $0.50/KB
–°—Ç–∞—Ç—É—Å: ACTIVE
```

### SBD-10 (SBD Tiered 1250 10K)
```
–í–∫–ª—é—á–µ–Ω–æ: 10 KB
–°—Ç—É–ø–µ–Ω—å 1: 10-25 KB √ó $0.30/KB
–°—Ç—É–ø–µ–Ω—å 2: 25-50 KB √ó $0.20/KB
–°—Ç—É–ø–µ–Ω—å 3:    50+ KB √ó $0.10/KB
–°—Ç–∞—Ç—É—Å: ACTIVE
–î–∞–Ω–Ω—ã–µ: 4,227 –∑–∞–ø–∏—Å–µ–π, $26,529.07 –ø—Ä–µ–≤—ã—à–µ–Ω–∏–π
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL
```
Host:     localhost
Port:     5432
Database: billing
User:     postgres
Password: 1234
```

### –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
- `V_SPNET_OVERAGE_ANALYSIS` - –∞–Ω–∞–ª–∏–∑ SPNet —Å —Ä–∞—Å—á–µ—Ç–æ–º –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è
- `V_CONSOLIDATED_OVERAGE_REPORT` - –∫–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç SPNet+STECCOM

### –¢–∞–±–ª–∏—Ü—ã
- `SPNET_TRAFFIC` - 12,969 –∑–∞–ø–∏—Å–µ–π
- `STECCOM_EXPENSES` - 35,696 –∑–∞–ø–∏—Å–µ–π
- `TARIFF_PLANS` - 2 –∞–∫—Ç–∏–≤–Ω—ã—Ö (SBD-1, SBD-10)

### –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞
```sql
calculate_overage(plan_name, usage_bytes) RETURNS NUMERIC
-- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è: usage_bytes / 1000.0 = KB
-- –°—Ç—É–ø–µ–Ω—á–∞—Ç—ã–π —Ä–∞—Å—á–µ—Ç –ø–æ —Ç–∞—Ä–∏—Ñ—É
```

## üìù –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- `streamlit_report.py` - –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (—É–ø—Ä–æ—â–µ–Ω–Ω–æ–µ, –±–µ–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫)

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- `setup_postgres.sql` - —Å—Ö–µ–º–∞ PostgreSQL
- `load_data_postgres.py` - –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `README.md` - –æ—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `TZ.md` - —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ
- `CHANGELOG.md` - –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- `SUMMARY.md` - –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
- `STATUS.md` - —ç—Ç–æ—Ç —Ñ–∞–π–ª (—Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å)

### –î–ª—è Oracle (–ø—Ä–æ–¥–∞–∫—à–µ–Ω)
- `oracle_tables.sql` - —Å—Ö–µ–º–∞ Oracle
- `create_tariff_plans.sql` - —Ç–∞—Ä–∏—Ñ—ã Oracle
- `load_spnet_traffic.py` - –∑–∞–≥—Ä—É–∑–∫–∞ SPNet
- `load_steccom_expenses.py` - –∑–∞–≥—Ä—É–∑–∫–∞ STECCOM
- `streamlit_report_oracle.py` - –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è Oracle

## ‚úÖ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. **–£–±—Ä–∞–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ SBD-1/SBD-10**
   - –¢–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –í–°–ï —Ç–∞—Ä–∏—Ñ—ã
   - Calculated Overage —Ç–æ–ª—å–∫–æ –¥–ª—è SBD-1 –∏ SBD-10

2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω SPNet Total Amount**
   - –¢–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ —Ç–∏–ø—ã: Data Usage + Mailbox Checks + Registrations
   - Calculated Overage —Å—á–∏—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è Data Usage

3. **–£–±—Ä–∞–Ω fillna(0)**
   - NULL –≤ –±–∞–∑–µ = –ø—É—Å—Ç–∞—è —è—á–µ–π–∫–∞ –≤ –æ—Ç—á–µ—Ç–µ
   - –ù–µ –∑–∞–º–µ–Ω—è–µ–º NULL –Ω–∞ 0

4. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –≤ V_SPNET_OVERAGE_ANALYSIS**
   - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ IMEI+CONTRACT+BILL_MONTH+PLAN
   - –ë–µ–∑ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –ø–æ USAGE_TYPE

## üöÄ –ö–æ–º–∞–Ω–¥—ã

### –ó–∞–ø—É—Å–∫
```bash
cd /mnt/ai/cnn/ai_report
streamlit run streamlit_report.py --server.port 8502
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
pkill -f streamlit
```

### –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
```bash
python3 load_data_postgres.py
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
```bash
PGPASSWORD=1234 psql -h localhost -p 5432 -U postgres -d billing -c "
SELECT PLAN_NAME, COUNT(*), SUM(CALCULATED_OVERAGE) 
FROM V_CONSOLIDATED_OVERAGE_REPORT 
GROUP BY PLAN_NAME;"
```

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
curl -s http://localhost:8502/_stcore/health

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
ps aux | grep streamlit | grep -v grep

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
PGPASSWORD=1234 psql -h localhost -p 5432 -U postgres -d billing \
  -c "SELECT COUNT(*) FROM V_CONSOLIDATED_OVERAGE_REPORT;"
```

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è)

1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
2. –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ Oracle (–ø—Ä–æ–¥–∞–∫—à–µ–Ω)
3. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã
4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è

- **1 KB = 1000 bytes** (–Ω–µ 1024) - –¥–µ—Å—è—Ç–∏—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
- **Calculated Overage** —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤ (SBD-1, SBD-10)
- **SPNet Total Amount** –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ —Ç–∏–ø—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- **NULL –∑–Ω–∞—á–µ–Ω–∏—è** –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–∞–∫ –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ (–Ω–µ –∑–∞–º–µ–Ω—è—é—Ç—Å—è –Ω–∞ 0)
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –∏–∑ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö CSV —Ñ–∞–π–ª–æ–≤

---
**–î–∞—Ç–∞:** 2025-10-28 19:20  
**–í–µ—Ä—Å–∏—è:** Final (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ


