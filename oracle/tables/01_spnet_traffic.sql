-- ============================================================================
-- SPNET_TRAFFIC - Таблица трафика SPNet
-- Назначение: Хранение данных об использовании Iridium M2M из отчетов SPNet
-- База данных: Oracle (production)
-- ============================================================================

CREATE TABLE SPNET_TRAFFIC (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    TOTAL_ROWS NUMBER,
    CONTRACT_ID VARCHAR2(50),
    IMEI VARCHAR2(50),
    SIM_ICCID VARCHAR2(50),
    SERVICE VARCHAR2(100),
    USAGE_TYPE VARCHAR2(100),
    USAGE_BYTES NUMBER,
    USAGE_UNIT VARCHAR2(20),
    TOTAL_AMOUNT NUMBER(10,2),
    BILL_MONTH NUMBER(6),
    PLAN_NAME VARCHAR2(100),
    IMSI VARCHAR2(50),
    MSISDN VARCHAR2(50),
    ACTUAL_USAGE NUMBER,
    CALL_SESSION_COUNT NUMBER,
    SP_ACCOUNT_NO NUMBER,
    SP_NAME VARCHAR2(100),
    SP_REFERENCE VARCHAR2(100),
    SOURCE_FILE VARCHAR2(200),
    LOAD_DATE DATE DEFAULT SYSDATE,
    CREATED_BY VARCHAR2(50) DEFAULT USER
);

-- Индексы для оптимизации запросов
CREATE INDEX IDX_SPNET_IMEI ON SPNET_TRAFFIC(IMEI);
CREATE INDEX IDX_SPNET_CONTRACT ON SPNET_TRAFFIC(CONTRACT_ID);
CREATE INDEX IDX_SPNET_BILL_MONTH ON SPNET_TRAFFIC(BILL_MONTH);
CREATE INDEX IDX_SPNET_SERVICE ON SPNET_TRAFFIC(SERVICE);
CREATE INDEX IDX_SPNET_PLAN_NAME ON SPNET_TRAFFIC(PLAN_NAME);
CREATE INDEX IDX_SPNET_USAGE_TYPE ON SPNET_TRAFFIC(USAGE_TYPE);

-- Комментарии
COMMENT ON TABLE SPNET_TRAFFIC IS 'Таблица трафика SPNet - данные об использовании Iridium M2M';
COMMENT ON COLUMN SPNET_TRAFFIC.ID IS 'Первичный ключ (auto-increment)';
COMMENT ON COLUMN SPNET_TRAFFIC.CONTRACT_ID IS 'ID контракта - связь с биллингом (SERVICES.LOGIN)';
COMMENT ON COLUMN SPNET_TRAFFIC.IMEI IS 'IMEI номер устройства';
COMMENT ON COLUMN SPNET_TRAFFIC.USAGE_BYTES IS 'Объем использованных данных в байтах';
COMMENT ON COLUMN SPNET_TRAFFIC.USAGE_TYPE IS 'Тип использования (SBD Data Usage, Mailbox Check, Registration)';
COMMENT ON COLUMN SPNET_TRAFFIC.TOTAL_AMOUNT IS 'Общая сумма за использование (USD)';
COMMENT ON COLUMN SPNET_TRAFFIC.BILL_MONTH IS 'Месяц биллинга (формат: month*10000+year, например 92025)';
COMMENT ON COLUMN SPNET_TRAFFIC.PLAN_NAME IS 'Название тарифного плана';
COMMENT ON COLUMN SPNET_TRAFFIC.SOURCE_FILE IS 'Имя загруженного CSV файла';
COMMENT ON COLUMN SPNET_TRAFFIC.LOAD_DATE IS 'Дата и время загрузки записи';

PROMPT Таблица SPNET_TRAFFIC создана успешно!


