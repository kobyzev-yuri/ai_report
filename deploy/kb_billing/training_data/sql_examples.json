[
  {
    "question": "Покажи всех активных сервисов Iridium",
    "sql": "SELECT service_id, contract_id, imei, customer_name, agreement_number, code_1c FROM v_iridium_services_info WHERE status = 10 AND contract_id NOT LIKE '%-clone-%' ORDER BY customer_name",
    "context": "Поиск активных Iridium сервисов",
    "business_entity": "services",
    "complexity": 1,
    "category": "Сервисы"
  },
  {
    "question": "Найди сервис по IMEI 300234069603430",
    "sql": "SELECT service_id, contract_id, imei, customer_name, agreement_number, status FROM v_iridium_services_info WHERE imei = '300234069603430'",
    "context": "Поиск сервиса по IMEI устройства",
    "business_entity": "services",
    "complexity": 1,
    "category": "Поиск"
  },
  {
    "question": "Покажи превышение трафика за октябрь 2025",
    "sql": "SELECT imei, contract_id, customer_name, plan_name, total_usage_kb, overage_kb, calculated_overage FROM v_consolidated_report_with_billing WHERE bill_month_yyyymm = 202510 ORDER BY calculated_overage DESC",
    "context": "Анализ превышения трафика за период",
    "business_entity": "overage",
    "complexity": 2,
    "category": "Превышение трафика"
  },
  {
    "question": "Сервисы с высоким превышением трафика больше 50 долларов",
    "sql": "SELECT imei, contract_id, customer_name, code_1c, bill_month, plan_name, total_usage_kb, overage_kb, calculated_overage FROM v_consolidated_report_with_billing WHERE calculated_overage > 50 AND service_status = 1 ORDER BY calculated_overage DESC",
    "context": "Выявление сервисов с высоким превышением",
    "business_entity": "overage",
    "complexity": 2,
    "category": "Финансовые алерты"
  },
  {
    "question": "Покажи все сервисы клиента по коду 1С",
    "sql": "SELECT service_id, contract_id, imei, customer_name, agreement_number, order_number FROM v_iridium_services_info WHERE code_1c = '1C00123' AND status = 10 ORDER BY create_date DESC",
    "context": "Поиск сервисов клиента по коду 1С",
    "business_entity": "customers",
    "complexity": 2,
    "category": "Клиенты"
  },
  {
    "question": "Найди информацию по клиенту АК Ямал Салехардский филиал - интересует код 1С",
    "sql": "SELECT DISTINCT c.CUSTOMER_ID, NVL(MAX(CASE WHEN cd.MNEMONIC = 'description' AND cc.CONTACT_DICT_ID = 23 THEN cc.VALUE END), TRIM(NVL(MAX(CASE WHEN cd.MNEMONIC = 'last_name' AND cc.CONTACT_DICT_ID = 11 THEN cc.VALUE END), '') || ' ' || NVL(MAX(CASE WHEN cd.MNEMONIC = 'first_name' AND cc.CONTACT_DICT_ID = 11 THEN cc.VALUE END), '') || ' ' || NVL(MAX(CASE WHEN cd.MNEMONIC = 'middle_name' AND cc.CONTACT_DICT_ID = 11 THEN cc.VALUE END), ''))) AS CUSTOMER_NAME, (SELECT oi.EXT_ID FROM OUTER_IDS oi WHERE oi.ID = c.CUSTOMER_ID AND UPPER(TRIM(oi.TBL)) = 'CUSTOMERS' AND ROWNUM = 1) AS CODE_1C FROM CUSTOMERS c LEFT JOIN BM_CUSTOMER_CONTACT cc ON c.CUSTOMER_ID = cc.CUSTOMER_ID LEFT JOIN BM_CONTACT_DICT cd ON cc.CONTACT_DICT_ID = cd.CONTACT_DICT_ID WHERE (UPPER(cc.VALUE) LIKE UPPER('%АК Ямал Салехардский филиал%') OR UPPER(cc.VALUE) LIKE UPPER('%АК ЯМАЛ САЛЕХАРДСКИЙ ФИЛИАЛ%')) AND ((cd.MNEMONIC = 'description' AND cc.CONTACT_DICT_ID = 23) OR (cd.MNEMONIC IN ('first_name', 'last_name', 'middle_name') AND cc.CONTACT_DICT_ID = 11)) GROUP BY c.CUSTOMER_ID ORDER BY CUSTOMER_NAME",
    "context": "Поиск кода 1С клиента по имени. ВАЖНО: Клиента может не быть в V_IRIDIUM_SERVICES_INFO, но код 1С есть в OUTER_IDS. Нужно найти customer_id по имени в BM_CUSTOMER_CONTACT (для организаций CONTACT_DICT_ID = 23, MNEMONIC = 'description'; для физлиц CONTACT_DICT_ID = 11, MNEMONIC IN ('first_name', 'last_name', 'middle_name')), затем найти код 1С в OUTER_IDS по customer_id (где TBL = 'CUSTOMERS', регистр не важен). Используй UPPER для поиска по имени, так как регистр может отличаться.",
    "business_entity": "customers",
    "complexity": 3,
    "category": "Клиенты"
  },
  {
    "question": "Найди все сервисы клиента АК Ямал Салехардский филиал",
    "sql": "SELECT service_id, contract_id, imei, customer_name, code_1c, agreement_number, order_number, status, actual_status, tariff_id, create_date, start_date FROM v_iridium_services_info WHERE UPPER(customer_name) LIKE UPPER('%АК Ямал Салехардский филиал%') ORDER BY contract_id, create_date DESC",
    "context": "Поиск всех сервисов клиента по имени. Включает SBD сервисы (TYPE_ID=9002), мониторинг (9005), приостановление (9008), блокировку мониторинга (9013), сообщения (9014). Показывает контракты (SUB-), IMEI, договоры, статусы и другую информацию об услугах.",
    "business_entity": "services",
    "complexity": 2,
    "category": "Клиенты"
  },
  {
    "question": "Покажи все сервисы клиента по коду 1С 1C00123",
    "sql": "SELECT service_id, contract_id, imei, customer_name, code_1c, agreement_number, order_number, status, actual_status, tariff_id, create_date, start_date FROM v_iridium_services_info WHERE code_1c = '1C00123' ORDER BY contract_id, create_date DESC",
    "context": "Поиск всех сервисов клиента по коду 1С. Включает все типы услуг (SBD, мониторинг, приостановление и т.д.). Показывает контракты, IMEI, договоры, статусы.",
    "business_entity": "services",
    "complexity": 2,
    "category": "Клиенты"
  },
  {
    "question": "Найди все сервисы клиента с customer_id 12345",
    "sql": "SELECT service_id, contract_id, imei, customer_name, code_1c, agreement_number, order_number, status, actual_status, tariff_id, create_date, start_date FROM v_iridium_services_info WHERE customer_id = 12345 ORDER BY contract_id, create_date DESC",
    "context": "Поиск всех сервисов клиента по customer_id. Включает все типы услуг Iridium (SBD, мониторинг, приостановление, блокировка мониторинга, сообщения).",
    "business_entity": "services",
    "complexity": 1,
    "category": "Клиенты"
  },
  {
    "question": "Покажи информацию о клиенте по customer_id 12345",
    "sql": "SELECT DISTINCT c.CUSTOMER_ID, NVL(MAX(CASE WHEN cd.MNEMONIC = 'description' AND cc.CONTACT_DICT_ID = 23 THEN cc.VALUE END), TRIM(NVL(MAX(CASE WHEN cd.MNEMONIC = 'last_name' AND cc.CONTACT_DICT_ID = 11 THEN cc.VALUE END), '') || ' ' || NVL(MAX(CASE WHEN cd.MNEMONIC = 'first_name' AND cc.CONTACT_DICT_ID = 11 THEN cc.VALUE END), '') || ' ' || NVL(MAX(CASE WHEN cd.MNEMONIC = 'middle_name' AND cc.CONTACT_DICT_ID = 11 THEN cc.VALUE END), ''))) AS CUSTOMER_NAME, (SELECT oi.EXT_ID FROM OUTER_IDS oi WHERE oi.ID = c.CUSTOMER_ID AND UPPER(TRIM(oi.TBL)) = 'CUSTOMERS' AND ROWNUM = 1) AS CODE_1C FROM CUSTOMERS c LEFT JOIN BM_CUSTOMER_CONTACT cc ON c.CUSTOMER_ID = cc.CUSTOMER_ID LEFT JOIN BM_CONTACT_DICT cd ON cc.CONTACT_DICT_ID = cd.CONTACT_DICT_ID WHERE c.CUSTOMER_ID = 12345 GROUP BY c.CUSTOMER_ID",
    "context": "Поиск информации о клиенте по customer_id. Возвращает имя клиента (организация или ФИО) и код 1С из OUTER_IDS.",
    "business_entity": "customers",
    "complexity": 2,
    "category": "Клиенты"
  },
  {
    "question": "Найди сервис по контракту SUB-12345",
    "sql": "SELECT service_id, contract_id, imei, customer_name, code_1c, agreement_number, order_number, status, actual_status, tariff_id, create_date, start_date FROM v_iridium_services_info WHERE contract_id = 'SUB-12345' ORDER BY service_id",
    "context": "Поиск сервиса по контракту (SUB-). Может вернуть несколько записей, если есть связанные услуги (SBD, мониторинг, приостановление и т.д.) с одним контрактом.",
    "business_entity": "services",
    "complexity": 1,
    "category": "Поиск"
  },
  {
    "question": "Покажи все типы услуг клиента по имени",
    "sql": "SELECT s.SERVICE_ID, s.LOGIN AS CONTRACT_ID, s.VSAT AS IMEI, s.TYPE_ID, rt.DESCRIPTION AS SERVICE_TYPE, vi.CUSTOMER_NAME, vi.CODE_1C, vi.AGREEMENT_NUMBER, s.STATUS, s.ACTUAL_STATUS, s.CREATE_DATE FROM SERVICES s JOIN BM_RESOURCE_TYPE rt ON s.TYPE_ID = rt.RESOURCE_TYPE_ID LEFT JOIN V_IRIDIUM_SERVICES_INFO vi ON s.LOGIN = vi.CONTRACT_ID WHERE UPPER(vi.CUSTOMER_NAME) LIKE UPPER('%АК Ямал Салехардский филиал%') AND s.TYPE_ID IN (9002, 9005, 9008, 9013, 9014) ORDER BY s.TYPE_ID, s.CONTRACT_ID",
    "context": "Поиск всех типов услуг клиента (SBD 9002, мониторинг 9005, приостановление 9008, блокировка мониторинга 9013, сообщения 9014) по имени. Показывает тип услуги, контракт, IMEI, статусы.",
    "business_entity": "services",
    "complexity": 2,
    "category": "Клиенты"
  },
  {
    "question": "Найди информацию о клиенте по коду 1С 1C00123",
    "sql": "SELECT DISTINCT c.CUSTOMER_ID, NVL(MAX(CASE WHEN cd.MNEMONIC = 'description' AND cc.CONTACT_DICT_ID = 23 THEN cc.VALUE END), TRIM(NVL(MAX(CASE WHEN cd.MNEMONIC = 'last_name' AND cc.CONTACT_DICT_ID = 11 THEN cc.VALUE END), '') || ' ' || NVL(MAX(CASE WHEN cd.MNEMONIC = 'first_name' AND cc.CONTACT_DICT_ID = 11 THEN cc.VALUE END), '') || ' ' || NVL(MAX(CASE WHEN cd.MNEMONIC = 'middle_name' AND cc.CONTACT_DICT_ID = 11 THEN cc.VALUE END), ''))) AS CUSTOMER_NAME, oi.EXT_ID AS CODE_1C FROM CUSTOMERS c LEFT JOIN BM_CUSTOMER_CONTACT cc ON c.CUSTOMER_ID = cc.CUSTOMER_ID LEFT JOIN BM_CONTACT_DICT cd ON cc.CONTACT_DICT_ID = cd.CONTACT_DICT_ID LEFT JOIN OUTER_IDS oi ON oi.ID = c.CUSTOMER_ID AND UPPER(TRIM(oi.TBL)) = 'CUSTOMERS' WHERE oi.EXT_ID = '1C00123' GROUP BY c.CUSTOMER_ID, oi.EXT_ID",
    "context": "Поиск информации о клиенте по коду 1С. Возвращает customer_id и имя клиента (организация или ФИО) по коду 1С из OUTER_IDS.",
    "business_entity": "customers",
    "complexity": 2,
    "category": "Клиенты"
  },
  {
    "question": "Покажи все активные SBD сервисы клиента по имени",
    "sql": "SELECT service_id, contract_id, imei, customer_name, code_1c, agreement_number, order_number, tariff_id, create_date, start_date FROM v_iridium_services_info WHERE UPPER(customer_name) LIKE UPPER('%АК Ямал Салехардский филиал%') AND status = 10 AND contract_id LIKE 'SUB-%' ORDER BY contract_id",
    "context": "Поиск только активных SBD сервисов (TYPE_ID=9002) клиента по имени. SBD сервисы имеют контракты формата SUB-XXXXX и status = 10 (активный).",
    "business_entity": "services",
    "complexity": 2,
    "category": "Клиенты"
  },
  {
    "question": "Найди все IMEI клиента по имени",
    "sql": "SELECT DISTINCT imei, contract_id, customer_name, code_1c, agreement_number FROM v_iridium_services_info WHERE UPPER(customer_name) LIKE UPPER('%АК Ямал Салехардский филиал%') AND imei IS NOT NULL ORDER BY imei",
    "context": "Поиск всех уникальных IMEI устройств клиента по имени. Показывает IMEI, связанные контракты, имя клиента и код 1С.",
    "business_entity": "services",
    "complexity": 2,
    "category": "Клиенты"
  },
  {
    "question": "Сумма превышения трафика по организациям за последний месяц",
    "sql": "SELECT organization_name, code_1c, COUNT(DISTINCT service_id) as services, SUM(calculated_overage) as total_overage FROM v_consolidated_report_with_billing WHERE organization_name IS NOT NULL AND bill_month_yyyymm = TO_NUMBER(TO_CHAR(TRUNC(SYSDATE, 'MM'), 'YYYYMM')) GROUP BY organization_name, code_1c ORDER BY total_overage DESC",
    "context": "Агрегация превышения трафика по организациям",
    "business_entity": "overage",
    "complexity": 3,
    "category": "Аналитика"
  },
  {
    "question": "Сервисы без данных о трафике за последние 3 месяца",
    "sql": "SELECT s.service_id, s.contract_id, s.imei, s.customer_name, s.agreement_number, s.code_1c FROM v_iridium_services_info s WHERE s.status = 10 AND s.contract_id NOT LIKE '%-clone-%' AND NOT EXISTS (SELECT 1 FROM v_consolidated_report_with_billing r WHERE r.contract_id = s.contract_id AND r.bill_month_yyyymm >= TO_NUMBER(TO_CHAR(ADD_MONTHS(SYSDATE, -3), 'YYYYMM'))) ORDER BY s.create_date",
    "context": "Выявление сервисов без трафика",
    "business_entity": "services",
    "complexity": 3,
    "category": "Финансовые алерты"
  },
  {
    "question": "Расхождения между рассчитанным превышением и выставленной суммой больше 5 долларов",
    "sql": "SELECT imei, contract_id, customer_name, code_1c, bill_month, plan_name, calculated_overage, spnet_total_amount, ABS(spnet_total_amount - calculated_overage) as difference FROM v_consolidated_report_with_billing WHERE service_status = 1 AND ABS(spnet_total_amount - calculated_overage) > 5 ORDER BY difference DESC",
    "context": "Выявление расхождений в биллинге",
    "business_entity": "billing",
    "complexity": 3,
    "category": "Финансовые алерты"
  },
  {
    "question": "Полный отчет с данными клиентов за октябрь 2025",
    "sql": "SELECT imei, contract_id, service_id, code_1c, organization_name, customer_name, agreement_number, total_usage_kb, calculated_overage, fee_activation_fee, fee_advance_charge, fees_total FROM v_consolidated_report_with_billing WHERE bill_month_yyyymm = 202510 AND service_id IS NOT NULL ORDER BY calculated_overage DESC",
    "context": "Полный отчет с данными клиентов",
    "business_entity": "reports",
    "complexity": 2,
    "category": "Отчеты"
  },
  {
    "question": "Сервисы без кода 1С",
    "sql": "SELECT contract_id, customer_name, agreement_number, status FROM v_iridium_services_info WHERE status = 10 AND contract_id NOT LIKE '%-clone-%' AND code_1c IS NULL ORDER BY create_date DESC",
    "context": "Выявление сервисов без кода 1С",
    "business_entity": "services",
    "complexity": 2,
    "category": "Финансовые алерты"
  },
  {
    "question": "Трафик и события по контракту SUB-12345",
    "sql": "SELECT bill_month, plan_name, traffic_usage_bytes, mailbox_events, registration_events, events_count, total_usage_kb, overage_kb, calculated_overage FROM v_consolidated_overage_report WHERE contract_id = 'SUB-12345' ORDER BY bill_month DESC",
    "context": "Детализация трафика и событий по контракту",
    "business_entity": "traffic",
    "complexity": 2,
    "category": "Трафик"
  },
  {
    "question": "Сумма всех fees по типам за период",
    "sql": "SELECT bill_month, SUM(fee_activation_fee) as total_activation, SUM(fee_advance_charge) as total_advance, SUM(fee_credit) as total_credit, SUM(fees_total) as total_fees FROM v_consolidated_report_with_billing WHERE bill_month_yyyymm = 202510 GROUP BY bill_month",
    "context": "Агрегация fees по типам",
    "business_entity": "fees",
    "complexity": 3,
    "category": "Fees"
  },
  {
    "question": "Сервисы с постоянным высоким использованием трафика",
    "sql": "SELECT contract_id, customer_name, COUNT(*) as months_high_usage, AVG(overage_kb) as avg_overage FROM v_consolidated_report_with_billing WHERE overage_kb > included_kb * 0.5 AND bill_month_yyyymm >= TO_NUMBER(TO_CHAR(ADD_MONTHS(SYSDATE, -6), 'YYYYMM')) GROUP BY contract_id, customer_name HAVING COUNT(*) >= 3 ORDER BY avg_overage DESC",
    "context": "Выявление сервисов с постоянным превышением",
    "business_entity": "overage",
    "complexity": 4,
    "category": "Аналитика"
  },
  {
    "question": "Дубликаты IMEI в разных контрактах",
    "sql": "SELECT imei, COUNT(DISTINCT contract_id) as contract_count, STRING_AGG(DISTINCT contract_id, ', ') as contracts FROM v_consolidated_report_with_billing WHERE imei IS NOT NULL GROUP BY imei HAVING COUNT(DISTINCT contract_id) > 1 ORDER BY contract_count DESC",
    "context": "Выявление дубликатов IMEI",
    "business_entity": "services",
    "complexity": 3,
    "category": "Финансовые алерты"
  },
  {
    "question": "Авансы за предыдущий месяц",
    "sql": "SELECT imei, contract_id, customer_name, bill_month, fee_advance_charge_previous_month FROM v_consolidated_report_with_billing WHERE fee_advance_charge_previous_month > 0 AND bill_month_yyyymm = 202510 ORDER BY fee_advance_charge_previous_month DESC",
    "context": "Авансы за предыдущий период",
    "business_entity": "fees",
    "complexity": 2,
    "category": "Fees"
  },
  {
    "question": "Сервисы без трафика более 60 дней",
    "sql": "SELECT s.service_id, s.contract_id, s.imei, s.customer_name, s.create_date, TRUNC(SYSDATE) - TRUNC(s.create_date) as days_without_traffic FROM v_iridium_services_info s WHERE s.status = 10 AND s.contract_id NOT LIKE '%-clone-%' AND s.create_date < ADD_MONTHS(TRUNC(SYSDATE), -2) AND NOT EXISTS (SELECT 1 FROM v_consolidated_report_with_billing r WHERE r.contract_id = s.contract_id AND r.bill_month_yyyymm >= TO_NUMBER(TO_CHAR(ADD_MONTHS(SYSDATE, -2), 'YYYYMM'))) ORDER BY days_without_traffic DESC",
    "context": "Выявление неактивных сервисов",
    "business_entity": "services",
    "complexity": 3,
    "category": "Финансовые алерты"
  },
  {
    "question": "Сравнение планов из SPNet и STECCOM",
    "sql": "SELECT contract_id, imei, plan_name as spnet_plan, steccom_plan_name_monthly as steccom_plan, CASE WHEN plan_name != steccom_plan_name_monthly THEN 'DIFFERENT' ELSE 'SAME' END as comparison FROM v_consolidated_report_with_billing WHERE plan_name IS NOT NULL AND steccom_plan_name_monthly IS NOT NULL AND bill_month_yyyymm = 202510",
    "context": "Сравнение планов из разных источников",
    "business_entity": "plans",
    "complexity": 3,
    "category": "Планы"
  },
  {
    "question": "Экспорт данных для 1С за период",
    "sql": "SELECT imei, contract_id, code_1c, organization_name, customer_name, agreement_number, bill_month as period, total_usage_kb, overage_kb, calculated_overage, fee_activation_fee, fee_advance_charge, fee_advance_charge_previous_month, fees_total FROM v_consolidated_report_with_billing WHERE bill_month_yyyymm = 202510 AND code_1c IS NOT NULL ORDER BY code_1c, contract_id",
    "context": "Экспорт данных для системы 1С",
    "business_entity": "export",
    "complexity": 2,
    "category": "Экспорт"
  },
  {
    "question": "Статистика по тарифным планам",
    "sql": "SELECT plan_name, COUNT(DISTINCT contract_id) as services_count, AVG(total_usage_kb) as avg_usage, AVG(overage_kb) as avg_overage, SUM(calculated_overage) as total_overage_charge FROM v_consolidated_report_with_billing WHERE bill_month_yyyymm = 202510 AND plan_name IS NOT NULL GROUP BY plan_name ORDER BY total_overage_charge DESC",
    "context": "Статистика использования тарифных планов",
    "business_entity": "plans",
    "complexity": 3,
    "category": "Аналитика"
  },
  {
    "question": "Детализация трафика по типам использования",
    "sql": "SELECT contract_id, imei, bill_month, usage_type, SUM(usage_bytes) as total_bytes, SUM(total_amount) as total_amount FROM spnet_traffic WHERE contract_id = 'SUB-12345' AND bill_month = 202510 GROUP BY contract_id, imei, bill_month, usage_type ORDER BY usage_type",
    "context": "Детализация трафика по типам",
    "business_entity": "traffic",
    "complexity": 2,
    "category": "Трафик"
  },
  {
    "question": "Сервисы с приостановленными планами",
    "sql": "SELECT contract_id, imei, customer_name, steccom_plan_name_suspended, bill_month FROM v_consolidated_report_with_billing WHERE steccom_plan_name_suspended IS NOT NULL AND bill_month_yyyymm = 202510 ORDER BY customer_name",
    "context": "Сервисы с приостановленными тарифами",
    "business_entity": "plans",
    "complexity": 2,
    "category": "Планы"
  },
  {
    "question": "Покажи себестоимость по всем SUB- с доходами и затратами",
    "sql": "SELECT svc.LOGIN AS CONTRACT_ID, SUM(a.MONEY) AS REVENUE, SUM(se.AMOUNT) + SUM(sp.TOTAL_AMOUNT) AS TOTAL_COST, ROUND((SUM(se.AMOUNT) + SUM(sp.TOTAL_AMOUNT)) / SUM(a.MONEY) * 100, 2) AS COST_PERCENTAGE FROM SERVICES svc JOIN ANALYTICS a ON svc.SERVICE_ID = a.SERVICE_ID LEFT JOIN STECCOM_EXPENSES se ON svc.LOGIN = se.CONTRACT_ID LEFT JOIN SPNET_TRAFFIC sp ON svc.LOGIN = sp.CONTRACT_ID WHERE svc.TYPE_ID = 9002 AND svc.LOGIN LIKE 'SUB-%' GROUP BY svc.LOGIN HAVING SUM(a.MONEY) > 0 AND (SUM(se.AMOUNT) + SUM(sp.TOTAL_AMOUNT)) > 0 ORDER BY COST_PERCENTAGE DESC",
    "context": "Расчет себестоимости по SUB- с доходами и затратами",
    "business_entity": "cost_of_goods_sold",
    "complexity": 4,
    "category": "Себестоимость"
  },
  {
    "question": "SUB- с доходами, но без затрат Иридиум",
    "sql": "SELECT s.LOGIN AS CONTRACT_ID, SUM(a.MONEY) AS REVENUE, COUNT(*) AS ANALYTICS_COUNT FROM SERVICES s JOIN ANALYTICS a ON s.SERVICE_ID = a.SERVICE_ID WHERE s.TYPE_ID = 9002 AND s.LOGIN LIKE 'SUB-%' AND NOT EXISTS (SELECT 1 FROM STECCOM_EXPENSES se WHERE se.CONTRACT_ID = s.LOGIN) AND NOT EXISTS (SELECT 1 FROM SPNET_TRAFFIC sp WHERE sp.CONTRACT_ID = s.LOGIN) GROUP BY s.LOGIN ORDER BY REVENUE DESC",
    "context": "Выявление SUB- с доходами, но без затрат Иридиум (тесты, не активированы)",
    "business_entity": "cost_of_goods_sold",
    "complexity": 3,
    "category": "Себестоимость"
  },
  {
    "question": "SUB- с затратами Иридиум, но без доходов",
    "sql": "SELECT se.CONTRACT_ID, SUM(se.AMOUNT) AS COST_STECCOM, SUM(sp.TOTAL_AMOUNT) AS COST_SPNET FROM STECCOM_EXPENSES se LEFT JOIN SPNET_TRAFFIC sp ON se.CONTRACT_ID = sp.CONTRACT_ID WHERE se.CONTRACT_ID LIKE 'SUB-%' AND NOT EXISTS (SELECT 1 FROM ANALYTICS a JOIN SERVICES s ON a.SERVICE_ID = s.SERVICE_ID WHERE s.LOGIN = se.CONTRACT_ID AND s.TYPE_ID = 9002) AND NOT EXISTS (SELECT 1 FROM BM_INVOICE_ITEM ii JOIN SERVICES s ON ii.SERVICE_ID = s.SERVICE_ID WHERE s.LOGIN = se.CONTRACT_ID AND s.TYPE_ID = 9002) GROUP BY se.CONTRACT_ID ORDER BY COST_STECCOM DESC",
    "context": "Выявление SUB- с затратами Иридиум, но без доходов (не попали в счета-фактуры)",
    "business_entity": "cost_of_goods_sold",
    "complexity": 3,
    "category": "Себестоимость"
  },
  {
    "question": "Доходы и затраты по SUB- за период с тестовыми начислениями",
    "sql": "SELECT s.LOGIN AS CONTRACT_ID, a.PERIOD_ID, SUM(a.MONEY) AS REVENUE_ANALYTICS, COUNT(CASE WHEN a.INVOICE_ITEM_ID IS NULL THEN 1 END) AS TEST_ITEMS_COUNT, SUM(se.AMOUNT) AS COST_STECCOM, SUM(sp.TOTAL_AMOUNT) AS COST_SPNET FROM SERVICES s JOIN ANALYTICS a ON s.SERVICE_ID = a.SERVICE_ID LEFT JOIN STECCOM_EXPENSES se ON s.LOGIN = se.CONTRACT_ID LEFT JOIN SPNET_TRAFFIC sp ON s.LOGIN = sp.CONTRACT_ID WHERE s.TYPE_ID = 9002 AND s.LOGIN LIKE 'SUB-%' AND a.PERIOD_ID = 12345 GROUP BY s.LOGIN, a.PERIOD_ID ORDER BY s.LOGIN",
    "context": "Доходы и затраты по SUB- за период, включая тестовые начисления",
    "business_entity": "cost_of_goods_sold",
    "complexity": 4,
    "category": "Себестоимость"
  },
  {
    "question": "Все SUB- с флагами наличия доходов и затрат",
    "sql": "SELECT svc.LOGIN AS CONTRACT_ID, CASE WHEN ra.CONTRACT_ID IS NOT NULL THEN 'Y' ELSE 'N' END AS HAS_REVENUE, CASE WHEN cs.CONTRACT_ID IS NOT NULL OR csp.CONTRACT_ID IS NOT NULL THEN 'Y' ELSE 'N' END AS HAS_COST FROM SERVICES svc LEFT JOIN (SELECT DISTINCT s.LOGIN AS CONTRACT_ID FROM ANALYTICS a JOIN SERVICES s ON a.SERVICE_ID = s.SERVICE_ID WHERE s.TYPE_ID = 9002) ra ON svc.LOGIN = ra.CONTRACT_ID LEFT JOIN (SELECT DISTINCT CONTRACT_ID FROM STECCOM_EXPENSES WHERE CONTRACT_ID LIKE 'SUB-%') cs ON svc.LOGIN = cs.CONTRACT_ID LEFT JOIN (SELECT DISTINCT CONTRACT_ID FROM SPNET_TRAFFIC WHERE CONTRACT_ID LIKE 'SUB-%') csp ON svc.LOGIN = csp.CONTRACT_ID WHERE svc.TYPE_ID = 9002 AND svc.LOGIN LIKE 'SUB-%' ORDER BY svc.LOGIN",
    "context": "Все SUB- с флагами наличия доходов и затрат для выявления проблемных случаев",
    "business_entity": "cost_of_goods_sold",
    "complexity": 3,
    "category": "Себестоимость"
  }
]

