# –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ RAG –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –¥–ª—è KB_billing

## –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ KB_billing

**–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö:**
1. **DDL –æ–ø–∏—Å–∞–Ω–∏—è** - —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ SQL —Å—Ö–µ–º—ã (17 —Ç–∞–±–ª–∏—Ü + 4 –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è)
2. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü, –∫–æ–ª–æ–Ω–æ–∫, –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª (JSON —Ñ–∞–π–ª—ã)
3. **Q/A –ø—Ä–∏–º–µ—Ä—ã** - 24 –ø–∞—Ä—ã –≤–æ–ø—Ä–æ—Å (—Ä—É—Å—Å–∫–∏–π) ‚Üí SQL –∑–∞–ø—Ä–æ—Å
4. **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ** - —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏, –¥–æ–º–µ–Ω—ã, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

**–•–∞—Ä–∞–∫—Ç–µ—Ä —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏:**
- –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è —Ü–µ–ø–æ—á–∫–∞: `BM_CDR_ACCT ‚Üí BM_SERVICE_MONEY ‚Üí ANALYTICS ‚Üí BM_INVOICE_ITEM ‚Üí BM_INVOICE`
- –°–≤—è–∑–∏ –ø–æ –∫–ª—é—á–∞–º: `CONTRACT_ID` (SUB-XXXXX), `IMEI`, `SERVICE_ID`
- –ü—Ä–æ—Å—Ç—ã–µ JOIN –æ–ø–µ—Ä–∞—Ü–∏–∏ (LEFT JOIN, JOIN)
- –°–≤—è–∑–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ JSON —Ñ–∞–π–ª–∞—Ö –∫–∞–∫ `relationships`

**–ü—Ä–∏–º–µ—Ä—ã —Å–≤—è–∑–µ–π:**
```json
{
  "table": "SPNET_TRAFFIC",
  "type": "LEFT JOIN",
  "on": "SERVICES.LOGIN = SPNET_TRAFFIC.CONTRACT_ID AND SERVICES.VSAT = SPNET_TRAFFIC.IMEI"
}
```

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: **–ü–ª–æ—Å–∫–∞—è –±–∞–∑–∞ —Å similarity search –î–û–°–¢–ê–¢–û–ß–ù–ê**

### ‚úÖ –ü–æ—á–µ–º—É –ø–ª–æ—Å–∫–∞—è –±–∞–∑–∞ –ø–æ–¥—Ö–æ–¥–∏—Ç:

#### 1. **–ü—Ä–æ—Å—Ç–æ—Ç–∞ —Å–≤—è–∑–µ–π**
- –°–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ –ø—Ä–æ—Å—Ç—ã–µ (JOIN –ø–æ –∫–ª—é—á–∞–º)
- –ù–µ—Ç —Å–ª–æ–∂–Ω—ã—Ö –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã—Ö –≥—Ä–∞—Ñ–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –°–≤—è–∑–∏ —É–∂–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ JSON —Ñ–∞–π–ª–∞—Ö (`relationships`)
- LLM –º–æ–∂–µ—Ç –ø–æ–Ω—è—Ç—å —Å–≤—è–∑–∏ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –±–µ–∑ –≥—Ä–∞—Ñ–æ–≤–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

#### 2. **–•–∞—Ä–∞–∫—Ç–µ—Ä –∑–∞–¥–∞—á**
- **–û—Å–Ω–æ–≤–Ω–∞—è –∑–∞–¥–∞—á–∞**: —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ SQL
- **–í—Ç–æ—Ä–∏—á–Ω–∞—è –∑–∞–¥–∞—á–∞**: –ø–æ–∏—Å–∫ DDL –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ —Ç–∞–±–ª–∏—Ü–∞–º
- **–ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è**: –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å–ª–æ–∂–Ω—ã–º –≥—Ä–∞—Ñ–∞–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

#### 3. **–û–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö**
- 17 —Ç–∞–±–ª–∏—Ü + 4 –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (—É–º–µ—Ä–µ–Ω–Ω—ã–π –æ–±—ä–µ–º)
- 24 Q/A –ø—Ä–∏–º–µ—Ä–∞ (–º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å)
- –°–≤—è–∑–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã —è–≤–Ω–æ –≤ JSON

#### 4. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**
- –ü–ª–æ—Å–∫–∞—è –±–∞–∑–∞ –ø—Ä–æ—â–µ –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–µ
- –ë—ã—Å—Ç—Ä–µ–µ –ø–æ–∏—Å–∫ (–æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ –æ–±—Ö–æ–¥–∞ –≥—Ä–∞—Ñ–∞)
- –ú–µ–Ω—å—à–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

---

## –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ RAG

### –í–∞—Ä–∏–∞–Ω—Ç 1: **–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         –§–∏–Ω–∞–Ω—Å–∏—Å—Ç (–≤–æ–ø—Ä–æ—Å)              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      AI Agent (LLM + RAG)               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  1. –ü–æ–Ω–∏–º–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞            ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  2. –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫:             ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ     a) –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π (–≤–µ–∫—Ç–æ—Ä–Ω—ã–π) ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ     b) –§–∏–ª—å—Ç—Ä—ã –ø–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º     ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  3. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å–≤—è–∑–µ–π –∏–∑ JSON   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SQL                ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î (Qdrant/pgvector)        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  Collection: kb_billing          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ DDL (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î)          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ Documentation (–æ–ø–∏—Å–∞–Ω–∏—è)    ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ‚îÄ Q/A Examples (–ø—Ä–∏–º–µ—Ä—ã SQL)   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ Relationships (—Å–≤—è–∑–∏)      ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  Payload –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ:              ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - type: "ddl"|"doc"|"qa"|"rel"  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - table_name: "SPNET_TRAFFIC"   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - category: "–ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞"‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - complexity: 1-4               ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - relationships: [...]          ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –¥–ª—è –ø–æ—Ö–æ–∂–∏—Ö –ø—Ä–∏–º–µ—Ä–æ–≤
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º (—Ç–∞–±–ª–∏—Ü–∞, –∫–∞—Ç–µ–≥–æ—Ä–∏—è, —Å–ª–æ–∂–Ω–æ—Å—Ç—å)
- ‚úÖ –°–≤—è–∑–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ payload –∏ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

---

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –ë–î

#### –¢–∏–ø 1: DDL (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü)
```json
{
  "id": "ddl_spnet_traffic",
  "vector": [...],
  "payload": {
    "type": "ddl",
    "table_name": "SPNET_TRAFFIC",
    "content": "CREATE TABLE SPNET_TRAFFIC (...)",
    "schema": "billing",
    "key_columns": {...},
    "relationships": [
      {
        "table": "SERVICES",
        "type": "LEFT JOIN",
        "on": "SERVICES.LOGIN = SPNET_TRAFFIC.CONTRACT_ID"
      }
    ]
  }
}
```

#### –¢–∏–ø 2: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```json
{
  "id": "doc_spnet_traffic",
  "vector": [...],
  "payload": {
    "type": "documentation",
    "table_name": "SPNET_TRAFFIC",
    "content": "–¢–∞–±–ª–∏—Ü–∞ —Ç—Ä–∞—Ñ–∏–∫–∞ SPNet - –¥–∞–Ω–Ω—ã–µ –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ Iridium M2M —Å–µ—Ä–≤–∏—Å–æ–≤...",
    "business_rules": [...],
    "usage_notes": [...]
  }
}
```

#### –¢–∏–ø 3: Q/A –ø—Ä–∏–º–µ—Ä—ã
```json
{
  "id": "qa_example_001",
  "vector": [...],
  "payload": {
    "type": "qa_example",
    "question": "–ü–æ–∫–∞–∂–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ –∑–∞ –æ–∫—Ç—è–±—Ä—å 2025",
    "sql": "SELECT ... FROM v_consolidated_report_with_billing ...",
    "category": "–ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞",
    "complexity": 2,
    "business_entity": "overage",
    "table_names": ["V_CONSOLIDATED_REPORT_WITH_BILLING"]
  }
}
```

#### –¢–∏–ø 4: Relationships (—Å–≤—è–∑–∏)
```json
{
  "id": "rel_spnet_services",
  "vector": [...],
  "payload": {
    "type": "relationship",
    "source_table": "SPNET_TRAFFIC",
    "target_table": "SERVICES",
    "join_type": "LEFT JOIN",
    "join_condition": "SERVICES.LOGIN = SPNET_TRAFFIC.CONTRACT_ID AND SERVICES.VSAT = SPNET_TRAFFIC.IMEI",
    "description": "–°–≤—è–∑—å —Ç—Ä–∞—Ñ–∏–∫–∞ SPNet —Å —É—Å–ª—É–≥–∞–º–∏ –±–∏–ª–ª–∏–Ω–≥–∞"
  }
}
```

---

## –°—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–æ–∏—Å–∫–∞

### –®–∞–≥ 1: –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫
```python
# –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ –ø–æ –≤–æ–ø—Ä–æ—Å—É —Ñ–∏–Ω–∞–Ω—Å–∏—Å—Ç–∞
results = vector_db.search(
    query_vector=embed_question("–ü–æ–∫–∞–∂–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ –∑–∞ –æ–∫—Ç—è–±—Ä—å"),
    query_filter={
        "must": [
            {"key": "type", "match": {"value": "qa_example"}},
            {"key": "category", "match": {"value": "–ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞"}}
        ]
    },
    limit=5
)
```

### –®–∞–≥ 2: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å–≤—è–∑–µ–π
```python
# –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å–≤—è–∑–µ–π –¥–ª—è –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
table_names = extract_table_names(results)
relationships = vector_db.search(
    query_filter={
        "must": [
            {"key": "type", "match": {"value": "relationship"}},
            {"key": "source_table", "match": {"any": table_names}}
        ]
    }
)
```

### –®–∞–≥ 3: –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
```python
context = {
    "qa_examples": results,
    "relationships": relationships,
    "ddl": get_ddl_for_tables(table_names),
    "documentation": get_docs_for_tables(table_names)
}
```

### –®–∞–≥ 4: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SQL
```python
sql = llm.generate_sql(
    question=question,
    context=context
)
```

---

## –ö–æ–≥–¥–∞ Graph KB –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–µ–Ω?

Graph KB –∏–º–µ–µ—Ç —Å–º—ã—Å–ª, –µ—Å–ª–∏:

### ‚ùå –ù–ï –Ω—É–∂–µ–Ω Graph KB, –µ—Å–ª–∏:
- –°–≤—è–∑–∏ –ø—Ä–æ—Å—Ç—ã–µ (JOIN –ø–æ –∫–ª—é—á–∞–º) ‚úÖ **–í–∞—à —Å–ª—É—á–∞–π**
- –°–≤—è–∑–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã —è–≤–Ω–æ ‚úÖ **–í–∞—à —Å–ª—É—á–∞–π**
- –û—Å–Ω–æ–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ - –ø–æ–∏—Å–∫ –ø—Ä–∏–º–µ—Ä–æ–≤ ‚úÖ **–í–∞—à —Å–ª—É—á–∞–π**
- –£–º–µ—Ä–µ–Ω–Ω—ã–π –æ–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö ‚úÖ **–í–∞—à —Å–ª—É—á–∞–π**

### ‚úÖ Graph KB –ø–æ–ª–µ–∑–µ–Ω, –µ—Å–ª–∏:
- –°–ª–æ–∂–Ω—ã–µ –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ü–µ–ø–æ—á–∫–∏ –∏–∑ 5+ —Ç–∞–±–ª–∏—Ü)
- –ù–µ—è–≤–Ω—ã–µ —Å–≤—è–∑–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –≤—ã–≤–æ–¥–∏—Ç—å
- –¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≥—Ä–∞—Ñ—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–Ω–∞–π–¥–∏ –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å ANALYTICS —á–µ—Ä–µ–∑ 2 —É—Ä–æ–≤–Ω—è")
- –ë–æ–ª—å—à–æ–π –æ–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º —Å–≤—è–∑–µ–π
- –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–Ω–∞–ª–∏–∑ –≤–ª–∏—è–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π (impact analysis)

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –í—ã–±–æ—Ä –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –ë–î

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: Qdrant** (—Å–º. `VECTOR_DB_RECOMMENDATIONS.md`)

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:**
- **pgvector** - –µ—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å PostgreSQL
- **Chroma** - –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å–ª—É—á–∞–µ–≤

### 2. –ú–æ–¥–µ–ª—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** `intfloat/multilingual-e5-large` (1024d)
- –û—Ç–ª–∏—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
- –•–æ—Ä–æ—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ –¥–ª—è SQL –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** `cointegrated/rubert-tiny2` (312d) - –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç

### 3. –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

**–ß–∞–Ω–∫–∏–Ω–≥:**
- DDL: –ø–æ —Ç–∞–±–ª–∏—Ü–µ (1 —á–∞–Ω–∫ = 1 —Ç–∞–±–ª–∏—Ü–∞)
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: –ø–æ —Ç–∞–±–ª–∏—Ü–µ (1 —á–∞–Ω–∫ = 1 —Ç–∞–±–ª–∏—Ü–∞)
- Q/A –ø—Ä–∏–º–µ—Ä—ã: –ø–æ –ø—Ä–∏–º–µ—Ä—É (1 —á–∞–Ω–∫ = 1 –ø—Ä–∏–º–µ—Ä)
- Relationships: –ø–æ —Å–≤—è–∑–∏ (1 —á–∞–Ω–∫ = 1 —Å–≤—è–∑—å)

**–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ:**
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ: `type`, `table_name`, `category`
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ: `complexity`, `business_entity`, `relationships`

### 4. –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫

**–ö–æ–º–±–∏–Ω–∞—Ü–∏—è:**
1. **–í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫** - —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ
2. **–§–∏–ª—å—Ç—Ä—ã –ø–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º** - —Ç–æ—á–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ
3. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å–≤—è–∑–µ–π** - –∏–∑ payload relationships

**–ü—Ä–∏–º–µ—Ä:**
```python
# –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫
results = vector_db.search(
    query_vector=embedding,
    query_filter={
        "must": [
            {"key": "type", "match": {"value": "qa_example"}},
            {"key": "category", "match": {"value": "–ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞"}}
        ],
        "should": [
            {"key": "table_names", "match": {"any": ["V_CONSOLIDATED_REPORT_WITH_BILLING"]}}
        ]
    },
    limit=5
)
```

---

## –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö (1-2 –¥–Ω—è)
1. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è JSON ‚Üí –≤–µ–∫—Ç–æ—Ä—ã
2. –°–æ–∑–¥–∞–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
3. –ó–∞–≥—Ä—É–∑–∫–∞ –≤ Qdrant —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏

### –≠—Ç–∞–ø 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–∏—Å–∫–∞ (1 –¥–µ–Ω—å)
1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è top-k (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 5-10)

### –≠—Ç–∞–ø 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∞–≥–µ–Ω—Ç–æ–º (2-3 –¥–Ω—è)
1. RAG pipeline (Retrieval ‚Üí Augmentation ‚Üí Generation)
2. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
3. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å–≤—è–∑–µ–π –∏–∑ payload
4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SQL —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

### –≠—Ç–∞–ø 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (1-2 –¥–Ω—è)
1. –¢–µ—Å—Ç—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö —Ñ–∏–Ω–∞–Ω—Å–∏—Å—Ç–æ–≤
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ—á–Ω–æ—Å—Ç–∏ SQL
3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–µ—Ç—Ä–∏–∫

---

## –ò—Ç–æ–≥–æ–≤–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

### ‚úÖ **–ü–ª–æ—Å–∫–∞—è –±–∞–∑–∞ —Å similarity search –î–û–°–¢–ê–¢–û–ß–ù–ê**

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –°–≤—è–∑–∏ –ø—Ä–æ—Å—Ç—ã–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã —è–≤–Ω–æ
2. –û—Å–Ω–æ–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ - —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø—Ä–∏–º–µ—Ä–æ–≤
3. –ù–µ—Ç —Å–ª–æ–∂–Ω—ã—Ö –≥—Ä–∞—Ñ–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
4. –ü—Ä–æ—â–µ –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–µ

### ‚ùå **Graph KB –ù–ï –Ω—É–∂–µ–Ω**

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –ò–∑–±—ã—Ç–æ—á–µ–Ω –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å–≤—è–∑–µ–π
2. –£—Å–ª–æ–∂–Ω–∏—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –±–µ–∑ –≤—ã–≥–æ–¥—ã
3. –°–≤—è–∑–∏ —É–∂–µ –µ—Å—Ç—å –≤ JSON —Ñ–∞–π–ª–∞—Ö
4. LLM –º–æ–∂–µ—Ç –ø–æ–Ω—è—Ç—å —Å–≤—è–∑–∏ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

### üéØ **–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**

```
–ü–ª–æ—Å–∫–∞—è –≤–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î (Qdrant)
  ‚îú‚îÄ‚îÄ DDL (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü)
  ‚îú‚îÄ‚îÄ Documentation (–æ–ø–∏—Å–∞–Ω–∏—è)
  ‚îú‚îÄ‚îÄ Q/A Examples (–ø—Ä–∏–º–µ—Ä—ã SQL)
  ‚îî‚îÄ‚îÄ Relationships (—Å–≤—è–∑–∏ –≤ payload)
  
–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫:
  ‚îú‚îÄ‚îÄ –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π (–≤–µ–∫—Ç–æ—Ä–Ω—ã–π)
  ‚îú‚îÄ‚îÄ –§–∏–ª—å—Ç—Ä—ã –ø–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º
  ‚îî‚îÄ‚îÄ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å–≤—è–∑–µ–π –∏–∑ payload
```

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 1. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ Q/A –ø—Ä–∏–º–µ—Ä–æ–≤
- –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –¥–ª—è —Å–ª–∞–±—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- –°–æ–±—Ä–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Ñ–∏–Ω–∞–Ω—Å–∏—Å—Ç–æ–≤
- –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ—Ñ—Ä–∞–∑—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–∏–º–µ—Ä–æ–≤

### 2. –£–ª—É—á—à–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- –†–∞—Å—à–∏—Ä–∏—Ç—å –±–∏–∑–Ω–µ—Å-—Å—É—â–Ω–æ—Å—Ç–∏
- –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–≥–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

### 3. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —á–∞—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–î–ª—è KB_billing **–ø–ª–æ—Å–∫–∞—è –±–∞–∑–∞ —Å similarity search —è–≤–ª—è–µ—Ç—Å—è –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º —Ä–µ—à–µ–Ω–∏–µ–º**. –°–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ –ø—Ä–æ—Å—Ç—ã–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã, –æ—Å–Ω–æ–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ - —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ SQL. Graph KB –±—ã–ª –±—ã –∏–∑–±—ã—Ç–æ—á–µ–Ω –∏ —É—Å–ª–æ–∂–Ω–∏–ª –±—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –±–µ–∑ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –≤—ã–≥–æ–¥—ã.

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –í—ã–±—Ä–∞—Ç—å –≤–µ–∫—Ç–æ—Ä–Ω—É—é –ë–î (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è Qdrant)
2. –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ —Å–æ–∑–¥–∞—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–∏
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫
4. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å AI –∞–≥–µ–Ω—Ç–æ–º
5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö












