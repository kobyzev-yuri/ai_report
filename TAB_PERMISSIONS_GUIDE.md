# üîê –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–∫–ª–∞–¥–∫–∞–º - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

## üìã –û–±–∑–æ—Ä

–ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å, –∫–∞–∫–∏–µ –≤–∫–ª–∞–¥–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –∫–∞–∂–¥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ Streamlit –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

1. **–ì—Ä–∞–Ω—É–ª—è—Ä–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞** - –∫–∞–∂–¥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –º–æ–∂–Ω–æ –Ω–∞–∑–Ω–∞—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –≤–∫–ª–∞–¥–∫–∞–º
2. **–°—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** - –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –≤–∫–ª–∞–¥–∫–∞–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
3. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ CLI** - –ø—Ä–æ—Å—Ç–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É
4. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ UI** - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –≤ Streamlit

## üìä –î–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏

| –ö–ª—é—á | –ù–∞–∑–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|----------|
| `assistant` | ü§ñ –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç | RAG-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SQL –∑–∞–ø—Ä–æ—Å–æ–≤ |
| `kb_expansion` | üìö –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ KB | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π |
| `report` | üí∞ –†–∞—Å—Ö–æ–¥—ã –ò—Ä–∏–¥–∏—É–º | –û—Å–Ω–æ–≤–Ω–æ–π –æ—Ç—á–µ—Ç –ø–æ —Ä–∞—Å—Ö–æ–¥–∞–º |
| `revenue` | üí∞ –î–æ—Ö–æ–¥—ã | –û—Ç—á–µ—Ç –ø–æ –¥–æ—Ö–æ–¥–∞–º –∏–∑ —Å—á–µ—Ç–æ–≤-—Ñ–∞–∫—Ç—É—Ä |
| `analytics` | üìã –°—á–µ—Ç–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥ | –û—Ç—á–µ—Ç –ø–æ —Å—á–µ—Ç–∞–º –∏–∑ ANALYTICS |
| `loader` | üì• Data Loader | –ó–∞–≥—Ä—É–∑–∫–∞ CSV/Excel —Ñ–∞–π–ª–æ–≤ |
| `ifindex` | 7206_ifindex | –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç –ø–æ ifindex |
| `ifindex_mapping` | üîÄ –ú–∞–ø–ø–∏–Ω–≥ –∏–Ω–¥–µ–∫—Å–æ–≤ 7206 | –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç –ø–æ –º–∞–ø–ø–∏–Ω–≥—É |

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–û–±–Ω–æ–≤–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∏–º–ø–æ—Ä—Ç–µ
python3 -c "from auth_db_v2 import init_db; init_db()"
```

–≠—Ç–æ –¥–æ–±–∞–≤–∏—Ç –∫–æ–ª–æ–Ω–∫—É `allowed_tabs` –≤ —Ç–∞–±–ª–∏—Ü—É `users` –∏ –æ–±–Ω–æ–≤–∏—Ç –ø—Ä–∞–≤–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø—Ä–∞–≤–∞–º–∏

```bash
# –°—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –≤–∫–ª–∞–¥–∫–∞–º)
python create_user_v2.py create --username admin --password secret123 --superuser

# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç–æ–ª—å–∫–æ —Å –æ—Ç—á–µ—Ç–∞–º–∏
python create_user_v2.py create --username accountant --password pass123 --tabs report revenue

# –ê–Ω–∞–ª–∏—Ç–∏–∫ —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—É –∏ –æ—Ç—á–µ—Ç–∞–º
python create_user_v2.py create --username analyst --password pass123 --tabs assistant kb_expansion report revenue analytics

# –û–ø–µ—Ä–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
python create_user_v2.py create --username operator --password pass123 --tabs loader report
```

### 3. –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∏—Ö –ø—Ä–∞–≤

```bash
python create_user_v2.py list
```

–í—ã–≤–æ–¥:
```
================================================================================
–°–ü–ò–°–û–ö –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô –° –ü–†–ê–í–ê–ú–ò –î–û–°–¢–£–ü–ê
================================================================================

üë§ –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: admin [SUPERUSER]
   –°–æ–∑–¥–∞–Ω: 2025-12-28T18:00:00
   –ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥: 2025-12-28T18:30:00
   –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏:
      üëë –í–°–ï –í–ö–õ–ê–î–ö–ò (—Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)

üë§ –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: analyst
   –°–æ–∑–¥–∞–Ω: 2025-12-28T18:05:00
   –ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥: 2025-12-28T18:25:00
   –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏:
      ‚Ä¢ assistant: ü§ñ –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç
      ‚Ä¢ kb_expansion: üìö –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ KB
      ‚Ä¢ report: üí∞ –†–∞—Å—Ö–æ–¥—ã –ò—Ä–∏–¥–∏—É–º
      ‚Ä¢ revenue: üí∞ –î–æ—Ö–æ–¥—ã
      ‚Ä¢ analytics: üìã –°—á–µ—Ç–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥
```

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```bash
# –î–æ–±–∞–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –Ω–æ–≤—ã–º –≤–∫–ª–∞–¥–∫–∞–º
python create_user_v2.py update-permissions --username analyst --tabs assistant kb_expansion report revenue analytics loader

# –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –æ—Ç—á–µ—Ç–∞–º–∏
python create_user_v2.py update-permissions --username analyst --tabs report revenue
```

### 5. –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–∫–ª–∞–¥–æ–∫

```bash
python create_user_v2.py show-tabs
```

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Streamlit –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `streamlit_report_oracle_backup.py`

#### 1. –ò–º–ø–æ—Ä—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –º–æ–¥—É–ª—è

```python
# –ó–∞–º–µ–Ω–∏—Ç—å
from auth_db import (
    init_db, create_user, list_users, change_password, 
    delete_user, is_superuser, authenticate_user
)

# –ù–∞
from auth_db_v2 import (
    init_db, create_user, list_users, change_password, 
    delete_user, is_superuser, authenticate_user,
    update_user_permissions, get_user_permissions, AVAILABLE_TABS
)
```

#### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

```python
def show_login_page():
    """–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—Ö–æ–¥–∞"""
    st.title("üîê –°–∏—Å—Ç–µ–º–∞ –æ—Ç—á–µ—Ç–æ–≤ –ø–æ Iridium M2M")
    st.markdown("---")
    
    st.info("üí° –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç `create_user_v2.py`")
    
    st.subheader("–í—Ö–æ–¥")
    with st.form("login_form"):
        login_username = st.text_input("–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è", key="login_username")
        login_password = st.text_input("–ü–∞—Ä–æ–ª—å", type="password", key="login_password")
        login_submitted = st.form_submit_button("–í–æ–π—Ç–∏", use_container_width=True)
        
        if login_submitted:
            if not login_username or not login_password:
                st.error("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è")
            else:
                # –ò–ó–ú–ï–ù–ï–ù–û: authenticate_user —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 4 –∑–Ω–∞—á–µ–Ω–∏—è
                success, username, is_super, allowed_tabs = authenticate_user(login_username, login_password)
                if success:
                    st.session_state.authenticated = True
                    st.session_state.username = username
                    st.session_state.is_superuser = is_super
                    st.session_state.allowed_tabs = allowed_tabs  # –ù–û–í–û–ï
                    st.success(f"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {username}! üëã")
                    st.rerun()
                else:
                    st.error("–ù–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –ø–∞—Ä–æ–ª—å")
```

#### 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è session state

```python
def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"""
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è session state –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    if 'authenticated' not in st.session_state:
        st.session_state.authenticated = False
    if 'username' not in st.session_state:
        st.session_state.username = None
    if 'is_superuser' not in st.session_state:
        st.session_state.is_superuser = False
    if 'allowed_tabs' not in st.session_state:  # –ù–û–í–û–ï
        st.session_state.allowed_tabs = []
```

#### 4. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∫–ª–∞–¥–æ–∫ –ø–æ –ø—Ä–∞–≤–∞–º –¥–æ—Å—Ç—É–ø–∞

```python
# –ü–æ–ª—É—á–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
allowed_tabs = st.session_state.get('allowed_tabs', [])

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫–∞–∫–∏–µ –≤–∫–ª–∞–¥–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å
tab_configs = []

if 'assistant' in allowed_tabs:
    tab_configs.append(('tab_assistant', 'ü§ñ –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç'))
if 'kb_expansion' in allowed_tabs:
    tab_configs.append(('tab_kb_expansion', 'üìö –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ KB'))
if 'report' in allowed_tabs:
    tab_configs.append(('tab_report', 'üí∞ –†–∞—Å—Ö–æ–¥—ã –ò—Ä–∏–¥–∏—É–º'))
if 'revenue' in allowed_tabs:
    tab_configs.append(('tab_revenue', 'üí∞ –î–æ—Ö–æ–¥—ã'))
if 'analytics' in allowed_tabs:
    tab_configs.append(('tab_analytics', 'üìã –°—á–µ—Ç–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥'))
if 'loader' in allowed_tabs:
    tab_configs.append(('tab_loader', 'üì• Data Loader'))
if 'ifindex' in allowed_tabs:
    tab_configs.append(('tab_ifindex', '7206_ifindex'))
if 'ifindex_mapping' in allowed_tabs:
    tab_configs.append(('tab_ifindex_mapping', 'üîÄ –ú–∞–ø–ø–∏–Ω–≥ –∏–Ω–¥–µ–∫—Å–æ–≤ 7206'))

# –ï—Å–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–∫–ª–∞–¥–æ–∫, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
if not tab_configs:
    st.error("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –Ω–∏ –∫ –æ–¥–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.")
    st.stop()

# –°–æ–∑–¥–∞–µ–º –≤–∫–ª–∞–¥–∫–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
tab_names = [name for _, name in tab_configs]
tabs = st.tabs(tab_names)

# –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–æ–∫
for i, (tab_key, tab_name) in enumerate(tab_configs):
    with tabs[i]:
        if tab_key == 'tab_assistant':
            # –ö–æ–¥ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç
            pass
        elif tab_key == 'tab_kb_expansion':
            # –ö–æ–¥ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ KB
            pass
        # ... –∏ —Ç.–¥. –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –≤–∫–ª–∞–¥–æ–∫
```

#### 5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

```python
def show_user_management():
    """–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)"""
    if not st.session_state.get('is_superuser', False):
        return
    
    st.sidebar.markdown("---")
    st.sidebar.subheader("üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏")
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    with st.sidebar.expander("‚ûï –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"):
        with st.form("create_user_form"):
            new_username = st.text_input("–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
            new_password = st.text_input("–ü–∞—Ä–æ–ª—å", type="password")
            new_is_super = st.checkbox("–°—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å")
            
            # –ù–û–í–û–ï: –í—ã–±–æ—Ä —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –≤–∫–ª–∞–¥–æ–∫
            if not new_is_super:
                st.write("–†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏:")
                selected_tabs = []
                for tab_key, tab_name in AVAILABLE_TABS.items():
                    if st.checkbox(tab_name, key=f"new_tab_{tab_key}"):
                        selected_tabs.append(tab_key)
            else:
                selected_tabs = None  # –°—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏—Ç –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            
            create_submitted = st.form_submit_button("–°–æ–∑–¥–∞—Ç—å")
            
            if create_submitted:
                success, message = create_user(
                    new_username, 
                    new_password, 
                    is_superuser=new_is_super,
                    allowed_tabs=selected_tabs,  # –ù–û–í–û–ï
                    created_by=st.session_state.username
                )
                if success:
                    st.sidebar.success(message)
                    st.rerun()
                else:
                    st.sidebar.error(message)
    
    # –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –ø—Ä–∞–≤–∞–º–∏
    with st.sidebar.expander("üìã –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"):
        users = list_users()
        if users:
            for user in users:
                superuser_mark = " üëë" if user['is_superuser'] else ""
                st.write(f"**{user['username']}**{superuser_mark}")
                if user['last_login']:
                    st.caption(f"–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥: {user['last_login'][:10]}")
                
                # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏
                if not user['is_superuser']:
                    allowed = user.get('allowed_tabs', [])
                    if allowed:
                        st.caption(f"–í–∫–ª–∞–¥–∫–∏: {', '.join([AVAILABLE_TABS.get(t, t) for t in allowed[:3]])}" + 
                                 (f" +{len(allowed)-3}" if len(allowed) > 3 else ""))
                    else:
                        st.caption("‚ö†Ô∏è –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞")
                
                # –ö–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∞–≤ (–∫—Ä–æ–º–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
                if user['username'] != st.session_state.username and not user['is_superuser']:
                    if st.button("‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞", key=f"edit_{user['username']}"):
                        st.session_state.editing_user = user['username']
                        st.session_state.editing_tabs = user.get('allowed_tabs', [])
                        st.rerun()
                    
                    if st.button("üóëÔ∏è –£–¥–∞–ª–∏—Ç—å", key=f"delete_{user['username']}"):
                        success, message = delete_user(user['username'])
                        if success:
                            st.sidebar.success(message)
                            st.rerun()
                        else:
                            st.sidebar.error(message)
        else:
            st.write("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
    
    # –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if st.session_state.get('editing_user'):
        with st.sidebar.expander(f"‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: {st.session_state.editing_user}", expanded=True):
            with st.form("edit_permissions_form"):
                st.write("–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏:")
                selected_tabs = []
                current_tabs = st.session_state.get('editing_tabs', [])
                
                for tab_key, tab_name in AVAILABLE_TABS.items():
                    if st.checkbox(tab_name, value=(tab_key in current_tabs), key=f"edit_tab_{tab_key}"):
                        selected_tabs.append(tab_key)
                
                col1, col2 = st.columns(2)
                with col1:
                    save_submitted = st.form_submit_button("üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å")
                with col2:
                    cancel_submitted = st.form_submit_button("‚ùå –û—Ç–º–µ–Ω–∞")
                
                if save_submitted:
                    success, message = update_user_permissions(
                        st.session_state.editing_user,
                        selected_tabs
                    )
                    if success:
                        st.sidebar.success(message)
                        del st.session_state.editing_user
                        del st.session_state.editing_tabs
                        st.rerun()
                    else:
                        st.sidebar.error(message)
                
                if cancel_submitted:
                    del st.session_state.editing_user
                    del st.session_state.editing_tabs
                    st.rerun()
```

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–æ–ª–µ–π

#### –ë—É—Ö–≥–∞–ª—Ç–µ—Ä (—Ç–æ–ª—å–∫–æ –æ—Ç—á–µ—Ç—ã)
```bash
python create_user_v2.py create \
  --username accountant \
  --password secure123 \
  --tabs report revenue
```

#### –ê–Ω–∞–ª–∏—Ç–∏–∫ (–æ—Ç—á–µ—Ç—ã + –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç)
```bash
python create_user_v2.py create \
  --username analyst \
  --password secure123 \
  --tabs assistant kb_expansion report revenue analytics
```

#### –û–ø–µ—Ä–∞—Ç–æ—Ä –¥–∞–Ω–Ω—ã—Ö (–∑–∞–≥—Ä—É–∑–∫–∞ + –ø—Ä–æ—Å–º–æ—Ç—Ä)
```bash
python create_user_v2.py create \
  --username operator \
  --password secure123 \
  --tabs loader report
```

#### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (–≤—Å–µ –≤–∫–ª–∞–¥–∫–∏)
```bash
python create_user_v2.py create \
  --username admin \
  --password secure123 \
  --superuser
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```bash
# –î–æ–±–∞–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—É
python create_user_v2.py update-permissions \
  --username analyst \
  --tabs assistant kb_expansion report revenue analytics loader

# –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –æ—Ç—á–µ—Ç–∞–º–∏
python create_user_v2.py update-permissions \
  --username analyst \
  --tabs report revenue
```

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è** - –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ `auth_db_v2.py`:
   - –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫–æ–ª–æ–Ω–∫–∞ `allowed_tabs`
   - –°—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –≤–∫–ª–∞–¥–∫–∞–º
   - –û–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –¥–æ—Å—Ç—É–ø –∫ –±–∞–∑–æ–≤—ã–º –≤–∫–ª–∞–¥–∫–∞–º (`report`, `revenue`)

2. **–†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤**:
```bash
# –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
python create_user_v2.py update-permissions --username user1 --tabs report revenue analytics
python create_user_v2.py update-permissions --username user2 --tabs assistant kb_expansion report
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–°—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** - –Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å –∏—Ö –ø—Ä–∞–≤–∞ –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å
2. **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤–∫–ª–∞–¥–æ–∫** - —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –≤—Å–µ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç
3. **–ó–∞—â–∏—Ç–∞ –æ—Ç —Å–∞–º–æ—É–¥–∞–ª–µ–Ω–∏—è** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å —Å–∞–º —Å–µ–±—è
4. **–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è bcrypt

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```sql
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username TEXT UNIQUE NOT NULL,
    password_hash TEXT NOT NULL,
    is_superuser INTEGER DEFAULT 0,
    allowed_tabs TEXT DEFAULT NULL,  -- JSON –º–∞—Å—Å–∏–≤ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –≤–∫–ª–∞–¥–æ–∫
    created_at TEXT NOT NULL,
    created_by TEXT,
    last_login TEXT
);
```

–ü—Ä–∏–º–µ—Ä `allowed_tabs`:
```json
["assistant", "kb_expansion", "report", "revenue", "analytics"]
```

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

```bash
# 1. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
cd deploy
SSH_CMD="ssh -p 1194" ./sync_deploy.sh root@82.114.2.2

# 2. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ: –º–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
ssh -p 1194 root@82.114.2.2
cd /usr/local/projects/ai_report
python3 -c "from auth_db_v2 import init_db; init_db()"

# 3. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø—Ä–∞–≤–∞–º–∏
python3 create_user_v2.py create --username admin --password secret --superuser
python3 create_user_v2.py create --username analyst --password pass --tabs assistant report revenue

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Streamlit
docker-compose restart streamlit
```

## üìñ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- **–§–∞–π–ª—ã**:
  - `auth_db_v2.py` - –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
  - `create_user_v2.py` - CLI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
  - `users.db` - SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

- **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**:
  - –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å `auth_db.py`
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞**:
  - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `python create_user_v2.py --help` –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏
  - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `python create_user_v2.py show-tabs` –¥–ª—è —Å–ø–∏—Å–∫–∞ –≤–∫–ª–∞–¥–æ–∫
