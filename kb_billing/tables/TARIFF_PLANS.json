{
  "table_name": "TARIFF_PLANS",
  "schema": "billing",
  "description": "Справочник тарифных планов SBD с ценами превышения трафика. Содержит информацию о включенном трафике (INCLUDED_KB) и ступенях тарификации превышения (TIER1, TIER2, TIER3).",
  "database": "Oracle (production) / PostgreSQL (testing)",
  "ddl": "CREATE TABLE TARIFF_PLANS (\n    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,\n    PLAN_NAME VARCHAR2(100) NOT NULL UNIQUE,\n    PLAN_CODE VARCHAR2(20),\n    INCLUDED_KB NUMBER NOT NULL,\n    TIER1_FROM_KB NUMBER,\n    TIER1_TO_KB NUMBER,\n    TIER1_PRICE_USD NUMBER(10,4),\n    TIER2_FROM_KB NUMBER,\n    TIER2_TO_KB NUMBER,\n    TIER2_PRICE_USD NUMBER(10,4),\n    TIER3_FROM_KB NUMBER,\n    TIER3_PRICE_USD NUMBER(10,4),\n    ACTIVE VARCHAR2(1) DEFAULT 'Y' CHECK (ACTIVE IN ('Y', 'N')),\n    CREATED_DATE DATE DEFAULT SYSDATE,\n    CREATED_BY VARCHAR2(50) DEFAULT USER,\n    COMMENTS VARCHAR2(500)\n);",
  "key_columns": {
    "PLAN_NAME": "Полное название тарифного плана из SPNet (уникальное). Примеры: 'SBD Tiered 1250 1K', 'SBD Tiered 1250 10K'",
    "PLAN_CODE": "Короткий код тарифа (например, SBD-1, SBD-10)",
    "INCLUDED_KB": "Объем трафика включенный в абонентку (КБ, 1KB=1000bytes). Используется для расчета превышения",
    "TIER1_FROM_KB": "Начало первой ступени превышения (КБ)",
    "TIER1_TO_KB": "Конец первой ступени превышения (КБ)",
    "TIER1_PRICE_USD": "Цена за 1 КБ на первой ступени превышения (USD)",
    "TIER2_FROM_KB": "Начало второй ступени превышения (КБ)",
    "TIER2_TO_KB": "Конец второй ступени превышения (КБ)",
    "TIER2_PRICE_USD": "Цена за 1 КБ на второй ступени превышения (USD)",
    "TIER3_FROM_KB": "Начало третьей ступени превышения (КБ, без верхнего порога)",
    "TIER3_PRICE_USD": "Цена за 1 КБ на третьей ступени превышения (USD)",
    "ACTIVE": "Активен ли тариф (Y/N). Только активные тарифы используются в расчетах"
  },
  "business_rules": [
    "PLAN_NAME должен точно соответствовать PLAN_NAME из SPNET_TRAFFIC",
    "Расчет превышения: OVERAGE_KB = TOTAL_USAGE_KB - INCLUDED_KB (если > 0)",
    "Стоимость превышения рассчитывается по ступеням: TIER1 (если в диапазоне), TIER2 (если в диапазоне), TIER3 (если превышает TIER2)",
    "Функция calculate_overage(PLAN_NAME, USAGE_BYTES) использует эту таблицу для расчета стоимости",
    "Только записи с ACTIVE = 'Y' используются в расчетах"
  ],
  "relationships": [
    {
      "table": "SPNET_TRAFFIC",
      "type": "LEFT JOIN",
      "on": "TARIFF_PLANS.PLAN_NAME = SPNET_TRAFFIC.PLAN_NAME AND TARIFF_PLANS.ACTIVE = 'Y'"
    }
  ],
  "indexes": [
    "IDX_TARIFF_PLAN_NAME ON TARIFF_PLANS(PLAN_NAME)",
    "IDX_TARIFF_PLAN_CODE ON TARIFF_PLANS(PLAN_CODE)",
    "IDX_TARIFF_ACTIVE ON TARIFF_PLANS(ACTIVE)"
  ],
  "usage_notes": [
    "Используется функцией calculate_overage() для расчета стоимости превышения трафика",
    "Примеры планов: 'SBD Tiered 1250 1K' (1KB включено), 'SBD Tiered 1250 10K' (10KB включено)",
    "Ступени тарификации применяются последовательно: сначала TIER1, затем TIER2, затем TIER3",
    "TIER3 не имеет верхнего порога (TIER3_TO_KB) - применяется ко всему превышению выше TIER2"
  ]
}





