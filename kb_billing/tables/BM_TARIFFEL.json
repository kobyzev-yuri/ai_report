{
  "table_name": "BM_TARIFFEL",
  "schema": "billing",
  "description": "Тарифные элементы - детальная тарификация тарифов. Содержит цены (MONEY) и параметры тарификации (STEP1-STEP4 для ступеней, LOGIN_QTY для количества логинов и т.д.). Один тариф (BM_TARIFF) может иметь несколько тарифных элементов с разными типами тарификации.",
  "database": "Oracle (production)",
  "key_columns": {
    "TARIFFEL_ID": "Уникальный идентификатор тарифного элемента (PRIMARY KEY)",
    "TARIFF_ID": "ID тарифа из BM_TARIFF. Связь с BM_TARIFF.TARIFF_ID",
    "TARIFFEL_TYPE_ID": "Тип тарифного элемента из BM_TARIFFEL_TYPE (например, абонентская плата, превышение трафика и т.д.)",
    "MONEY": "Цена/стоимость (NUMBER(38,15)). Основное поле для расчета доходов",
    "DATE_BEG": "Дата начала действия тарифного элемента",
    "DATE_END": "Дата окончания действия тарифного элемента (NULL если действует сейчас)",
    "STEP1": "Первая ступень тарификации (например, объем трафика)",
    "STEP2": "Вторая ступень тарификации",
    "STEP3": "Третья ступень тарификации",
    "STEP4": "Четвертая ступень тарификации",
    "LOGIN_QTY": "Количество логинов",
    "FLAG_VALUE": "Флаг применения коэффициента счетчика: 0 = коэффициент применяется при превышении порога (для SBD, TYPE_ID=10, 14 - Inet, SSG), 1 = коэффициент применяется до наступления порога (для IP телефонии и телефонии)",
    "PERIODIC_TYPE_ID": "Тип периодичности (ежемесячно, ежедневно и т.д.)",
    "RESOURCE_TYPE_ID": "Тип ресурса из BM_RESOURCE_TYPE. Связь с BM_RESOURCE_TYPE.RESOURCE_TYPE_ID. Используется для расшифровки услуг для бухгалтерии (MNEMONIC имеет хороший мнемонический смысл)",
    "ROOT_ID": "Корневой элемент (для иерархии)",
    "HEIR_ID": "Наследник (для иерархии)",
    "ZONE_ID": "ID зоны из BM_ZONE. Связь с BM_ZONE.ZONE_ID. Используется для тарификации с фиксированной ценой зоны в тарифном плане",
    "SEGMENT_ID": "ID сегмента",
    "CNT_PERIOD_ID": "ID периода счетчика из BM_CNT_PERIOD. Используется для связи с периодом действия счетчика",
    "COUNTER_CLASS_ID": "ID класса счетчика из BM_COUNTER_CLASS. Используется для связи с классом счетчика. Когда счетчик достигает порога, активируется коэффициент скидки (counter_cf) к основной цене за зону",
    "DESCRIPTION": "Описание тарифного элемента"
  },
  "business_rules": [
    "MONEY - основное поле для расчета доходов (цена услуги, стоимость превышения и т.д.)",
    "Один тариф может иметь несколько тарифных элементов (например, абонентская плата + превышение трафика)",
    "TARIFFEL_TYPE_ID определяет тип тарификации (абонентская плата, превышение, дополнительные услуги)",
    "STEP1-STEP4 используются для ступенчатой тарификации (аналогично TIER1-TIER3 в TARIFF_PLANS Иридиум)",
    "Для расчета доходов нужно суммировать MONEY всех тарифных элементов тарифа",
    "DATE_BEG и DATE_END определяют период действия тарифного элемента",
    "Для получения актуальных цен: DATE_END IS NULL или DATE_END >= текущая дата",
    "ZONE_ID определяет зону тарификации (фиксированная цена за зону)",
    "COUNTER_CLASS_ID связывает тарифный элемент с классом счетчика для коэффициента скидки",
    "CNT_PERIOD_ID определяет период действия счетчика",
    "FLAG_VALUE определяет логику применения коэффициента счетчика:",
    "  - FLAG_VALUE = 0: коэффициент применяется при превышении порога (VALUE >= THRESHOLD)",
    "    Используется для SBD, TYPE_ID=10, 14 (Inet, SSG) - чем больше потребление, тем больше скидка",
    "  - FLAG_VALUE = 1: коэффициент применяется до наступления порога (VALUE < THRESHOLD)",
    "    Используется для IP телефонии и телефонии - скидка действует пока не достигнут порог",
    "Когда счетчик (BM_COUNTER) достигает порога (в зависимости от FLAG_VALUE), активируется коэффициент скидки (counter_cf) к основной цене за зону",
    "Коэффициент скидки определяется в BM_TARIFFEL с MNEMONIC = 'counter_cf' (из BM_TARIFFEL_TYPE) и связан с COUNTER_CLASS_ID",
    "Счетчики связаны с сервисами через BM_SRV_CNT_LINK"
  ],
  "relationships": [
    {
      "table": "BM_TARIFF",
      "type": "JOIN",
      "on": "BM_TARIFFEL.TARIFF_ID = BM_TARIFF.TARIFF_ID"
    },
    {
      "table": "BM_TARIFFEL_TYPE",
      "type": "LEFT JOIN",
      "on": "BM_TARIFFEL.TARIFFEL_TYPE_ID = BM_TARIFFEL_TYPE.TARIFFEL_TYPE_ID"
    },
    {
      "table": "BM_RESOURCE_TYPE",
      "type": "LEFT JOIN",
      "on": "BM_TARIFFEL.RESOURCE_TYPE_ID = BM_RESOURCE_TYPE.RESOURCE_TYPE_ID",
      "note": "Расшифровка типа ресурса для бухгалтерии (MNEMONIC имеет хороший мнемонический смысл)"
    },
    {
      "table": "BM_ZONE",
      "type": "LEFT JOIN",
      "on": "BM_TARIFFEL.ZONE_ID = BM_ZONE.ZONE_ID",
      "note": "Тарифная зона с фиксированной ценой в тарифном плане"
    },
    {
      "table": "BM_COUNTER_CLASS",
      "type": "LEFT JOIN",
      "on": "BM_TARIFFEL.COUNTER_CLASS_ID = BM_COUNTER_CLASS.COUNTER_CLASS_ID",
      "note": "Класс счетчика для коэффициента скидки"
    },
    {
      "table": "BM_CNT_PERIOD",
      "type": "LEFT JOIN",
      "on": "BM_TARIFFEL.CNT_PERIOD_ID = BM_CNT_PERIOD.PERIOD_ID",
      "note": "Период действия счетчика"
    }
  ],
  "usage_notes": [
    "Используется для расчета доходов от клиентов",
    "MONEY содержит цену/стоимость тарифного элемента",
    "Для расчета себестоимости нужно сравнить доходы (из BM_TARIFFEL.MONEY) с затратами (из STECCOM_EXPENSES.AMOUNT и TARIFF_PLANS)",
    "STEP1-STEP4 могут использоваться для ступенчатой тарификации превышения трафика",
    "ZONE_ID определяет зону тарификации - разные цены для разных зон",
    "COUNTER_CLASS_ID и CNT_PERIOD_ID используются для системы счетчиков и коэффициентов скидки",
    "Когда счетчик достигает порога, активируется коэффициент скидки (counter_cf) к основной цене за зону",
    "Для понимания статей тарификации используйте BM_TARIFFEL_TYPE.MNEMONIC:",
    "  - 'fee' - абонентская плата (фиксированная ежемесячная)",
    "  - 'traffic_pay' / 'll_traffic_pay' - плата за трафик (переменная)",
    "  - 'counter_cf' - коэффициент скидки при достижении порога счетчика",
    "  - 'steps' - ступенчатая тарификация с разными ценами по ступеням"
  ]
}

