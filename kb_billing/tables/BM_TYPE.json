{
  "table_name": "BM_TYPE",
  "schema": "billing",
  "description": "Справочник типов услуг биллинга. Содержит информацию о всех типах услуг, включая Iridium M2M сервисы. Используется для фильтрации и классификации услуг.",
  "database": "Oracle (production)",
  "key_columns": {
    "TYPE_ID": "Уникальный идентификатор типа услуги (PRIMARY KEY). Связь с SERVICES.TYPE_ID",
    "CLASS": "Класс типа услуги (например, 'service')",
    "MNEMONIC": "Мнемоника типа услуги (например, 'iridium_sbd', 'iridium_monitoring')",
    "NAME": "Название типа услуги на русском языке (например, 'Услуга SBD', 'Платформа мониторинг', 'Приостановление услуг Иридиум SBD', 'Блокировка услуг мониторинга(GSM)')"
  },
  "business_rules": [
    "TYPE_ID = 9002: iridium_sbd - Услуга SBD (тарификация по трафику), LOGIN = SUB-XXXXX. ВАЖНО: Это ГЛАВНАЯ услуга, от которой зависят остальные (9008, 9005). Полное количество активных дней определяет часть снимаемой абонплаты для SBD",
    "TYPE_ID = 9005: iridium_monitoring - Платформа мониторинг. ВАЖНО: Зависит от главной услуги 9002 (SBD), но не для всех SBD есть мониторинг - только для тех, кто на услуге мониторинга",
    "TYPE_ID = 9008: iridium_sbd_suspend - Приостановление услуг Иридиум SBD, LOGIN = IMEI. ВАЖНО: Зависит от главной услуги 9002 (SBD). Дополнительная абонплата снимается за услугу приостановки SBD. Периоды приостановки отслеживаются через BM_ACTION_LOG (OLD_VALUE/NEW_VALUE)",
    "TYPE_ID = 9013: gsm_block - Блокировка услуг мониторинга(GSM)",
    "TYPE_ID = 9014: iridium_msg - услуга по сообщениям",
    "Иерархия зависимостей и режимы работы:",
    "  - 9002 (SBD) - ГЛАВНАЯ услуга, базовая",
    "  - 9005 (мониторинг) - зависит от 9002, но не для всех SBD есть, только для тех, кто на услуге мониторинга. ВАЖНО: Мониторинг и SBD активны ОДНОВРЕМЕННО",
    "  - 9008 (suspend) - зависит от 9002, услуги в противофазе, связаны по VSAT (IMEI) и ACCOUNT_ID. ВАЖНО: Приостановка активна в оставшееся время (когда SBD не активна)",
    "  - 9013 (gsm_block) - блокировка мониторинга. ВАЖНО: Блокировка активна в оставшееся время (когда SBD не активна)",
    "ВАЖНО для расчета абонплаты:",
    "  - TYPE_ID=9002 (SBD) - ГЛАВНАЯ услуга: полное количество активных дней определяет часть снимаемой абонплаты",
    "  - TYPE_ID=9005 (мониторинг) - зависит от 9002: не для всех SBD есть, только для тех, кто на услуге мониторинга. Мониторинг и SBD активны ОДНОВРЕМЕННО, поэтому абонплата начисляется за те же дни, что и SBD",
    "  - TYPE_ID=9008 (suspend) - зависит от 9002: дополнительная абонплата снимается за услугу приостановки SBD. Приостановка активна в ОСТАВШЕЕСЯ ВРЕМЯ (когда SBD не активна), поэтому абонплата начисляется за дни, когда SBD была приостановлена",
    "  - TYPE_ID=9013 (gsm_block) - блокировка мониторинга: активна в ОСТАВШЕЕСЯ ВРЕМЯ (когда SBD не активна)",
    "  - Для корректного расчета нужно отслеживать изменения статуса через BM_ACTION_LOG (OLD_VALUE/NEW_VALUE, MOMENT)",
    "  - При изменении статуса (ACTIVE → SUSPENDED или SUSPENDED → ACTIVE) нужно фиксировать MOMENT для расчета периодов",
    "  - При расчете абонплаты для 9008 и 9013 нужно учитывать, что они активны в оставшееся время (когда SBD не активна)",
    "  - При расчете абонплаты для 9005 нужно учитывать, что мониторинг активен одновременно с SBD"
  ],
  "relationships": [
    {
      "table": "SERVICES",
      "type": "JOIN",
      "on": "BM_TYPE.TYPE_ID = SERVICES.TYPE_ID"
    }
  ],
  "usage_notes": [
    "Используется для фильтрации услуг по типу",
    "Для Iridium M2M используются типы: 9002, 9005, 9008, 9013, 9014",
    "MNEMONIC используется для программной идентификации типа услуги",
    "ВАЖНО: Для расчета абонплаты SBD (9002) и suspend (9008) нужно отслеживать изменения статуса в BM_ACTION_LOG:",
    "  - SUB_ACTION_ID=3000 (suspend_sbd) ведется ТОЛЬКО для TYPE_ID=9002 (SBD - главная услуга)",
    "  - Для остальных услуг (9005, 9008, 9013) это избыточно, так как расчет начислений ведется для группы услуг на одном и том же IMEI (2 или 4 услуги)",
    "  - Когда меняется статус главной услуги 9002, автоматически меняются статусы зависимых услуг",
    "  - Найти все изменения статуса главной услуги: WHERE SERVICE_ID = :service_id AND TYPE_ID = 9002 AND SUB_ACTION_ID IN (3000, 3001, 30208)",
    "  - Восстановить периоды активности/приостановки на основе OLD_VALUE, NEW_VALUE и MOMENT для главной услуги 9002",
    "  - Рассчитать количество активных дней для абонплаты SBD (9002) и мониторинга (9005) - они активны одновременно",
    "  - Рассчитать количество дней приостановки для абонплаты suspend (9008) и блокировки (9013) - они активны в оставшееся время"
  ]
}















