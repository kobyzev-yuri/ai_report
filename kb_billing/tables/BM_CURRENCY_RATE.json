{
  "table_name": "BM_CURRENCY_RATE",
  "schema": "billing",
  "description": "Курсы валют для конверсии. Содержит исторические курсы валют, используемые в счетах-фактурах. Курс УЕ (CURRENCY_ID=4) к рублю берется на последний день месяца финансового периода для конверсии долларов в расходы в рубли и сравнения с доходами в рублях за тот же период.",
  "database": "Oracle (production)",
  "key_columns": {
    "RATE_ID": "Уникальный идентификатор записи курса (PRIMARY KEY)",
    "CURRENCY_ID": "ID валюты из BM_CURRENCY (4 = УЕ/доллары, 1 = рубли)",
    "DOMAIN_ID": "ID домена",
    "RATE": "Курс валюты (например, 64.0817 - курс УЕ к рублю)",
    "START_TIME": "Дата начала действия курса (используется для определения курса на конкретную дату)",
    "TS": "Timestamp последнего обновления записи"
  },
  "business_rules": [
    "Курс УЕ (CURRENCY_ID=4) к рублю берется на последний день месяца финансового периода",
    "Для получения курса на конкретную дату используется START_TIME (берется курс с максимальной START_TIME <= дата)",
    "Используется для конверсии расходов в долларах (USD) в рубли для сравнения с доходами в рублях",
    "Курс применяется к расходам из STECCOM_EXPENSES и SPNET_TRAFFIC, которые могут быть в долларах"
  ],
  "usage_notes": [
    "Для получения курса на последний день месяца финансового периода:",
    "SELECT RATE FROM BM_CURRENCY_RATE WHERE CURRENCY_ID = 4 AND START_TIME <= LAST_DAY(TO_DATE('2025-10', 'YYYY-MM')) ORDER BY START_TIME DESC FETCH FIRST 1 ROW ONLY",
    "Для конверсии расходов в долларах в рубли: расходы_в_рублях = расходы_в_долларах * курс_уе_к_рублю"
  ]
}

