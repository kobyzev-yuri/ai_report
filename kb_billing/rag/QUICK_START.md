# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç RAG —Å–∏—Å—Ç–µ–º—ã –¥–ª—è KB_billing

## –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

–ò–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ:
```bash
pip install qdrant-client sentence-transformers torch transformers
```

## –®–∞–≥ 2: –ó–∞–ø—É—Å–∫ Qdrant

```bash
# –ó–∞–ø—É—Å–∫ Qdrant –≤ Docker
docker run -d \
  --name qdrant \
  -p 6333:6333 \
  -v $(pwd)/qdrant_storage:/qdrant/storage \
  qdrant/qdrant

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã
curl http://localhost:6333/health
```

## –®–∞–≥ 3: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è KB

```bash
# –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö KB –≤ Qdrant
cd /mnt/ai/cnn/ai_report
python kb_billing/rag/init_kb.py

# –° –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ–º –∫–æ–ª–ª–µ–∫—Ü–∏–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
python kb_billing/rag/init_kb.py --recreate
```

–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
```
============================================================
–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è KB_billing –≤ Qdrant
============================================================
Qdrant: localhost:6333
–ö–æ–ª–ª–µ–∫—Ü–∏—è: kb_billing
–ú–æ–¥–µ–ª—å: intfloat/multilingual-e5-base
–ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å: False
============================================================

–ó–∞–≥—Ä—É–∑–∫–∞ Q/A –ø—Ä–∏–º–µ—Ä–æ–≤ –∏–∑ ...
–ó–∞–≥—Ä—É–∂–µ–Ω–æ 24 Q/A –ø—Ä–∏–º–µ—Ä–æ–≤
–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü –∏–∑ ...
–ó–∞–≥—Ä—É–∂–µ–Ω–æ 36 —Ç–æ—á–µ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü
...
============================================================
‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!
============================================================
```

## –®–∞–≥ 4: –ó–∞–ø—É—Å–∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

```bash
# –ó–∞–ø—É—Å–∫ Streamlit
./run_streamlit_background.sh

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é
streamlit run streamlit_report_oracle_backup.py
```

## –®–∞–≥ 5: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –ø–µ—Ä–≤—É—é –∑–∞–∫–ª–∞–¥–∫—É "ü§ñ –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç"
3. –í–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä:
   - "–ü–æ–∫–∞–∂–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ –∑–∞ –æ–∫—Ç—è–±—Ä—å 2025"
   - "–ù–∞–π–¥–∏ –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã Iridium"
   - "–ü–æ–∫–∞–∂–∏ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ –≤—Å–µ–º SUB-"
4. –ù–∞–∂–º–∏—Ç–µ "üìä –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å SQL"

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –¢–µ—Å—Ç –≤ Python

```python
from kb_billing.rag.rag_assistant import RAGAssistant

assistant = RAGAssistant()
examples = assistant.search_similar_examples("–ü–æ–∫–∞–∂–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ –∑–∞ –æ–∫—Ç—è–±—Ä—å 2025")

for example in examples:
    print(f"–í–æ–ø—Ä–æ—Å: {example['question']}")
    print(f"SQL: {example['sql']}")
    print(f"Similarity: {example['similarity']:.3f}")
    print()
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Qdrant

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π
curl http://localhost:6333/collections

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
curl http://localhost:6333/collections/kb_billing
```

## Troubleshooting

### –û—à–∏–±–∫–∞: "Connection refused" –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ Qdrant

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–ø—É—â–µ–Ω –ª–∏ Qdrant
docker ps | grep qdrant

# –ï—Å–ª–∏ –Ω–µ—Ç, –∑–∞–ø—É—Å—Ç–∏—Ç–µ
docker run -d -p 6333:6333 qdrant/qdrant
```

### –û—à–∏–±–∫–∞: "Collection not found"

```bash
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ KB
python kb_billing/rag/init_kb.py --recreate
```

### –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –º–æ–¥—É–ª–µ–π

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
cd /mnt/ai/cnn/ai_report

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip list | grep -E "qdrant|sentence-transformers"
```

### –ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –º–æ–¥–µ–ª—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ HuggingFace. –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç. –ú–æ–¥–µ–ª—å –∫—ç—à–∏—Ä—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—É—Å–∫–æ–≤.

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –î–æ–±–∞–≤—å—Ç–µ –±–æ–ª—å—à–µ Q/A –ø—Ä–∏–º–µ—Ä–æ–≤ –≤ `kb_billing/training_data/sql_examples.json`
2. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ KB: `python kb_billing/rag/init_kb.py --recreate`
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SQL –∑–∞–ø—Ä–æ—Å–æ–≤

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `kb_billing/rag/README.md`
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ: `kb_billing/RAG_ARCHITECTURE_RECOMMENDATION.md`
- –í—ã–±–æ—Ä –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –ë–î: `kb_billing/VECTOR_DB_FINAL_RECOMMENDATION.md`



