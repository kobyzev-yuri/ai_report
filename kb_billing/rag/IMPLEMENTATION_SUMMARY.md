# –†–µ–∑—é–º–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ RAG —Å–∏—Å—Ç–µ–º—ã –¥–ª—è KB_billing

## –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –ú–æ–¥—É–ª–∏ RAG —Å–∏—Å—Ç–µ–º—ã

#### `kb_loader.py`
- –ö–ª–∞—Å—Å `KBLoader` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ KB_billing –≤ Qdrant
- –ó–∞–≥—Ä—É–∑–∫–∞ Q/A –ø—Ä–∏–º–µ—Ä–æ–≤ –∏–∑ `training_data/sql_examples.json`
- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü –∏–∑ `tables/*.json`
- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π –∏–∑ `views/*.json`
- –ó–∞–≥—Ä—É–∑–∫–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏–∑ `metadata.json`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ —Å –ø–æ–º–æ—â—å—é Sentence Transformers

#### `rag_assistant.py`
- –ö–ª–∞—Å—Å `RAGAssistant` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å KB
- –ú–µ—Ç–æ–¥ `search_similar_examples()` - –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö Q/A –ø—Ä–∏–º–µ—Ä–æ–≤
- –ú–µ—Ç–æ–¥ `search_table_info()` - –ø–æ–∏—Å–∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–∞–±–ª–∏—Ü–µ
- –ú–µ—Ç–æ–¥ `search_semantic()` - —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø–æ KB
- –ú–µ—Ç–æ–¥ `get_context_for_sql_generation()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SQL
- –ú–µ—Ç–æ–¥ `format_context_for_llm()` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è LLM

#### `streamlit_assistant.py`
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è RAG –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –≤ Streamlit
- –§—É–Ω–∫—Ü–∏—è `show_assistant_tab()` - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–∫–ª–∞–¥–∫–∏ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
- –§—É–Ω–∫—Ü–∏—è `execute_sql_query()` - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SQL –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ Oracle
- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø—Ä–∏–º–µ—Ä–æ–≤ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SQL

#### `init_kb.py`
- –°–∫—Ä–∏–ø—Ç –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ KB
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
- –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –≤ Qdrant

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

- –î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è –∑–∞–∫–ª–∞–¥–∫–∞ "ü§ñ –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç" –≤ `streamlit_report_oracle_backup.py`
- –ó–∞–∫–ª–∞–¥–∫–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∞ –ø–µ—Ä–≤–æ–π –≤ —Å–ø–∏—Å–∫–µ —Ç–∞–±–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ Oracle

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

–î–æ–±–∞–≤–ª–µ–Ω—ã –≤ `requirements.txt`:
- `qdrant-client>=1.7.0` - –∫–ª–∏–µ–Ω—Ç –¥–ª—è Qdrant
- `sentence-transformers>=2.2.0` - –º–æ–¥–µ–ª–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
- `torch>=2.0.0` - PyTorch –¥–ª—è –º–æ–¥–µ–ª–µ–π
- `transformers>=4.30.0` - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä–æ–≤

### 4. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `README.md` - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è RAG —Å–∏—Å—Ç–µ–º—ã
- `QUICK_START.md` - –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- `DEPLOYMENT.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é
- `IMPLEMENTATION_SUMMARY.md` - —ç—Ç–æ—Ç —Ñ–∞–π–ª

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
kb_billing/rag/
‚îú‚îÄ‚îÄ __init__.py                    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞–∫–µ—Ç–∞
‚îú‚îÄ‚îÄ kb_loader.py                   # –ó–∞–≥—Ä—É–∑–∫–∞ KB –≤ Qdrant
‚îú‚îÄ‚îÄ rag_assistant.py               # RAG –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç
‚îú‚îÄ‚îÄ streamlit_assistant.py         # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Streamlit
‚îú‚îÄ‚îÄ init_kb.py                     # –°–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ README.md                      # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ QUICK_START.md                 # –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
‚îú‚îÄ‚îÄ DEPLOYMENT.md                  # –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
‚îî‚îÄ‚îÄ IMPLEMENTATION_SUMMARY.md      # –†–µ–∑—é–º–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
```

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –î–ª—è —Ñ–∏–Ω–∞–Ω—Å–∏—Å—Ç–∞

1. **–ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ SQL**
   - –í–≤–æ–¥ –≤–æ–ø—Ä–æ—Å–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
   - –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö Q/A –ø—Ä–∏–º–µ—Ä–æ–≤ –≤ KB
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ SQL –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

2. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è SQL –∑–∞–ø—Ä–æ—Å–æ–≤**
   - –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏–∑ KB
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—Ö–æ–∂–∏—Ö –ø—Ä–∏–º–µ—Ä–æ–≤
   - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–∞–±–ª–∏—Ü–∞—Ö –∏ –∏—Ö —Å–≤—è–∑—è—Ö
   - –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤ LLM

3. **–ü–æ–∏—Å–∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏**
   - –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø–æ KB
   - –ü–æ–∏—Å–∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
   - –ü—Ä–æ—Å–º–æ—Ç—Ä DDL –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π + —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ —á–µ—Ä–µ–∑ multilingual-e5-base
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Oracle –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ Qdrant

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è KB

```bash
# –ó–∞–ø—É—Å–∫ Qdrant
docker run -d -p 6333:6333 qdrant/qdrant

# –ó–∞–≥—Ä—É–∑–∫–∞ KB
python kb_billing/rag/init_kb.py
```

### –ó–∞–ø—É—Å–∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

```bash
./run_streamlit_background.sh
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

```python
from kb_billing.rag.rag_assistant import RAGAssistant

assistant = RAGAssistant()
examples = assistant.search_similar_examples("–ü–æ–∫–∞–∂–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞")
```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ KB**
   - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–æ–ª—å—à–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ Q/A –ø—Ä–∏–º–µ—Ä–æ–≤
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü
   - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª

2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å LLM**
   - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SQL —á–µ—Ä–µ–∑ LLM (OpenAI GPT, –ª–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏)
   - –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö SQL –∑–∞–ø—Ä–æ—Å–æ–≤
   - –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞

3. **–£–ª—É—á—à–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞**
   - –ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö SQL –∑–∞–ø—Ä–æ—Å–æ–≤
   - –≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã

4. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**
   - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ Qdrant
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–æ–ª–µ–µ –º–æ—â–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
–§–∏–Ω–∞–Ω—Å–∏—Å—Ç (–≤–æ–ø—Ä–æ—Å)
    ‚Üì
Streamlit –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    ‚Üì
RAGAssistant
    ‚Üì
Qdrant (–≤–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î)
    ‚Üì
–ö–æ–Ω—Ç–µ–∫—Å—Ç (–ø—Ä–∏–º–µ—Ä—ã + –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
    ‚Üì
–ì–µ–Ω–µ—Ä–∞—Ü–∏—è SQL / –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
    ‚Üì
Oracle Database
```

### –ú–æ–¥–µ–ª—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤

- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: `intfloat/multilingual-e5-base` (768 —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å)
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã: `intfloat/multilingual-e5-large` (1024), `cointegrated/rubert-tiny2` (312)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Qdrant

- **qa_example** - Q/A –ø—Ä–∏–º–µ—Ä—ã (24 –ø—Ä–∏–º–µ—Ä–∞)
- **ddl** - DDL –æ–ø–∏—Å–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü (17 —Ç–∞–±–ª–∏—Ü)
- **documentation** - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü (17 —Ç–∞–±–ª–∏—Ü)
- **view** - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π (4 –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è)
- **metadata** - –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å—Ö–µ–º—ã (1 –∑–∞–ø–∏—Å—å)

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è RAG —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è KB_billing, –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Streamlit. –°–∏—Å—Ç–µ–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ñ–∏–Ω–∞–Ω—Å–∏—Å—Ç–∞–º:

- –ò—Å–∫–∞—Ç—å –ø–æ—Ö–æ–∂–∏–µ –ø—Ä–∏–º–µ—Ä—ã SQL –∑–∞–ø—Ä–æ—Å–æ–≤
- –ü–æ–ª—É—á–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–æ–≤—ã—Ö SQL –∑–∞–ø—Ä–æ—Å–æ–≤
- –ò—Å–∫–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ —Ç–∞–±–ª–∏—Ü–∞–º –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è–º
- –í—ã–ø–æ–ª–Ω—è—Ç—å SQL –∑–∞–ø—Ä–æ—Å—ã –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —Å LLM –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SQL –∑–∞–ø—Ä–æ—Å–æ–≤.

